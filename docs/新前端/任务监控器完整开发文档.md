# ä»»åŠ¡ç›‘æ§å™¨å®Œæ•´å¼€å‘æ–‡æ¡£

> åŸºäºå•ä»»åŠ¡è¿è¡Œæœºåˆ¶çš„ä»»åŠ¡ç›‘æ§ç³»ç»Ÿé‡æ„æ–¹æ¡ˆ
>
> **æ ¸å¿ƒçº¦æŸï¼šç³»ç»Ÿåº•å±‚è®¾è®¡åªå…è®¸ä¸€ä¸ªä»»åŠ¡è¿è¡Œ**

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿè®¾è®¡åŸåˆ™](#1-ç³»ç»Ÿè®¾è®¡åŸåˆ™)
2. [æ¶æ„è®¾è®¡](#2-æ¶æ„è®¾è®¡)
3. [æ•°æ®ç»“æ„è®¾è®¡](#3-æ•°æ®ç»“æ„è®¾è®¡)
4. [ç»„ä»¶è®¾è®¡](#4-ç»„ä»¶è®¾è®¡)
5. [æŠ€æœ¯å®ç°æ–¹æ¡ˆ](#5-æŠ€æœ¯å®ç°æ–¹æ¡ˆ)
6. [ä»£ç ä¿®æ”¹æ¸…å•](#6-ä»£ç ä¿®æ”¹æ¸…å•)
7. [å®æ–½æ­¥éª¤](#7-å®æ–½æ­¥éª¤)
8. [éªŒæ”¶æ ‡å‡†](#8-éªŒæ”¶æ ‡å‡†)

---

## 1. ç³»ç»Ÿè®¾è®¡åŸåˆ™

### 1.1 æ ¸å¿ƒçº¦æŸ

**ç³»ç»Ÿåº•å±‚è®¾è®¡åªå…è®¸ä¸€ä¸ªä»»åŠ¡è¿è¡Œ**

è¿™æ„å‘³ç€ï¼š
- âœ… Processing åŒºåŸŸæ°¸è¿œåªæœ‰ 0-1 ä¸ªä»»åŠ¡
- âœ… ä¸éœ€è¦è€ƒè™‘å¤šä»»åŠ¡å¹¶è¡Œå¤„ç†çš„ç•Œé¢é€»è¾‘
- âœ… ä»»åŠ¡å®Œæˆåï¼Œä¸‹ä¸€ä¸ªæ’é˜Ÿä»»åŠ¡è‡ªåŠ¨å¼€å§‹
- âœ… ç®€åŒ–çŠ¶æ€ç®¡ç†é€»è¾‘

### 1.2 è®¾è®¡ç†å¿µ

1. **æ¸è¿›å¼æŠ«éœ² (Progressive Disclosure)**
   - Processing ä»»åŠ¡å¸¸é©»é¡¶éƒ¨ï¼Œä¸å¯æŠ˜å 
   - Queued ä»»åŠ¡é»˜è®¤å±•å¼€ï¼ˆç”¨æˆ·éœ€é¢‘ç¹è°ƒæ•´ä¼˜å…ˆçº§ï¼‰
   - Failed/Paused/Finished é»˜è®¤æŠ˜å ï¼ˆæ¬¡è¦ä¿¡æ¯ï¼‰

2. **å…³æ³¨ç‚¹åˆ†ç¦» (Separation of Concerns)**
   - æ´»è·ƒä»»åŠ¡ï¼ˆProcessing/Queuedï¼‰ï¼šå¼ºè°ƒå®æ—¶æ€§ä¸æ“æ§
   - å†å²ä»»åŠ¡ï¼ˆFinishedï¼‰ï¼šå¼ºè°ƒå½’æ¡£ä¸æŸ¥é˜…ï¼Œé™åˆ¶æ˜¾ç¤ºæ•°é‡

3. **å³æ—¶åé¦ˆ (Immediate Feedback)**
   - çŠ¶æ€å˜æ›´ä¼´éšæ˜ç¡®çš„è§†è§‰åé¦ˆ
   - ä½¿ç”¨ CSS + Vue TransitionGroup å®ç°æµç•…åŠ¨ç”»
   - ä»»åŠ¡å®Œæˆæ—¶æ˜¾ç¤ºçŸ­æš‚é«˜äº®

4. **æ€§èƒ½ä¼˜å…ˆ**
   - å†å²è®°å½•åªæ¸²æŸ“æœ€è¿‘ 20 æ¡
   - ä½¿ç”¨ CSS Grid æŠ˜å ï¼ˆä¸å¼•å…¥è™šæ‹Ÿæ»šåŠ¨ï¼‰
   - é¿å…å¤æ‚çš„ JS åŠ¨ç”»ç¼–æ’

---

## 2. æ¶æ„è®¾è®¡

### 2.1 æ•´ä½“å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header (Fixed)                      â”‚  â† Processing ä»»åŠ¡åŒºåŸŸ
â”‚ - æœ€å¤šæ˜¾ç¤º 1 ä¸ª Processing ä»»åŠ¡      â”‚     (å›ºå®šåœ¨é¡¶éƒ¨ï¼Œmax-height: 300px)
â”‚ - æ— ä»»åŠ¡æ—¶æ˜¾ç¤ºç©ºçŠ¶æ€                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Body (Scrollable)                   â”‚  â† ä»»åŠ¡åˆ†ç»„åŒºåŸŸ
â”‚                                     â”‚     (å æ®å‰©ä½™ç©ºé—´ï¼Œå¯æ»šåŠ¨)
â”‚ â”Œâ”€ SSE æ–­å¼€è­¦å‘Š (åŠ¨æ€æ˜¾ç¤º) â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ âš ï¸ å®æ—¶è¿æ¥å·²æ–­å¼€ï¼Œæ­£åœ¨é‡è¿...    â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€ å¤±è´¥ä»»åŠ¡ (é»˜è®¤æŠ˜å ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ ğŸ”´ å¤±è´¥ (3)              [âˆ§]    â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€ æ’é˜Ÿä¸­ (é»˜è®¤å±•å¼€) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ ğŸ”µ æ’é˜Ÿä¸­ (5)            [âˆ¨]    â”‚â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚ â”‚ â”‚ â‹®â‹® ä»»åŠ¡ A  [50%]  [â¸][Ã—]  â”‚ â”‚â”‚  â† å¯æ‹–åŠ¨æ’åº
â”‚ â”‚ â”‚ â‹®â‹® ä»»åŠ¡ B  [0%]   [â¸][Ã—]  â”‚ â”‚â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€ å·²æš‚åœ (é»˜è®¤æŠ˜å ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ ğŸŸ¡ å·²æš‚åœ (2)            [âˆ§]    â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€ æœ€è¿‘å®Œæˆ (é»˜è®¤æŠ˜å ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ ğŸŸ¢ æœ€è¿‘å®Œæˆ (20)         [âˆ§]    â”‚â”‚
â”‚ â”‚ æŸ¥çœ‹å…¨éƒ¨å†å²è®°å½• >              â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Footer (æ¸å˜é®ç½©)                   â”‚  â† è§†è§‰æç¤º
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘          â”‚     (pointer-events: none)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 çŠ¶æ€æµè½¬å›¾

```
[ä¸Šä¼ æ–‡ä»¶]
    â†“
[created] â”€â”€â”€â”€â”€â”€â†’ [queued] â”€â”€â”€â”€â”€â”€â†’ [processing] â”€â”€â”€â”€â”€â”€â†’ [finished]
                     â†“                  â†“                    â†‘
                     â”‚                  â”‚                    â”‚
                     â†“                  â†“                    â”‚
                  [paused] â†â”€â”€â”€â”€â”€â”€â”€â”€â†’ [failed] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
                     â†“
                  [canceled] (é™é»˜åˆ é™¤)
```

---

## 3. æ•°æ®ç»“æ„è®¾è®¡

### 3.1 æ ¸å¿ƒè®¾è®¡æ€æƒ³

**é‡‡ç”¨ Mapï¼ˆID ç´¢å¼•ï¼‰+ Arrayï¼ˆé˜Ÿåˆ—é¡ºåºï¼‰åŒç´¢å¼•æ¨¡å¼**

- `tasksMap`: å¿«é€ŸæŸ¥æ‰¾ä»»åŠ¡ï¼ˆO(1)ï¼‰
- `queueOrder`: ç»´æŠ¤é˜Ÿåˆ—é¡ºåºï¼ˆå•ä¸€äº‹å®æ¥æºï¼‰

### 3.2 Store ç»“æ„

```typescript
// stores/unifiedTaskStore.js

interface Task {
  job_id: string              // ä»»åŠ¡ ID
  filename: string            // æ–‡ä»¶å
  title?: string              // ç”¨æˆ·è‡ªå®šä¹‰æ ‡é¢˜
  status: TaskStatus          // ä»»åŠ¡çŠ¶æ€
  progress: number            // è¿›åº¦ 0-100
  phase?: string              // å½“å‰é˜¶æ®µ (extract/split/transcribe/align...)
  phase_percent?: number      // é˜¶æ®µå†…è¿›åº¦
  message?: string            // çŠ¶æ€æ¶ˆæ¯
  created_at: number          // åˆ›å»ºæ—¶é—´
  updated_at: number          // æ›´æ–°æ—¶é—´
  completed_at?: number       // å®Œæˆæ—¶é—´
  paused_at?: number          // æš‚åœæ—¶é—´
  failed_at?: number          // å¤±è´¥æ—¶é—´
  sseConnected?: boolean      // SSE è¿æ¥çŠ¶æ€ï¼ˆå‰ç«¯å­—æ®µï¼‰
  lastError?: string          // æœ€åé”™è¯¯ï¼ˆå‰ç«¯å­—æ®µï¼‰
  isNewlyFinished?: boolean   // åˆšå®Œæˆæ ‡è®°ï¼ˆå‰ç«¯å­—æ®µï¼Œç”¨äºé«˜äº®ï¼‰
}

type TaskStatus = 'created' | 'queued' | 'processing' | 'paused' | 'finished' | 'failed' | 'canceled'

interface TaskStore {
  // æ ¸å¿ƒæ•°æ®
  tasksMap: Map<string, Task>  // ID -> Task æ˜ å°„
  queueOrder: string[]         // é˜Ÿåˆ—é¡ºåºï¼ˆä»…åŒ…å« queued çŠ¶æ€çš„ä»»åŠ¡ IDï¼‰

  // SSE çŠ¶æ€
  sseConnected: boolean        // å…¨å±€ SSE è¿æ¥çŠ¶æ€
  lastHeartbeat: number        // æœ€åå¿ƒè·³æ—¶é—´

  // è®¡ç®—å±æ€§ï¼ˆGettersï¼‰
  processingTask: Task | null         // å½“å‰å¤„ç†ä¸­çš„ä»»åŠ¡ï¼ˆæœ€å¤š 1 ä¸ªï¼‰
  queuedTasks: Task[]                 // æ’é˜Ÿä»»åŠ¡ï¼ˆæŒ‰ queueOrder æ’åºï¼‰
  failedTasks: Task[]                 // å¤±è´¥ä»»åŠ¡ï¼ˆæŒ‰å¤±è´¥æ—¶é—´å€’åºï¼‰
  pausedTasks: Task[]                 // æš‚åœä»»åŠ¡ï¼ˆæŒ‰æš‚åœæ—¶é—´å€’åºï¼‰
  recentFinishedTasks: Task[]         // æœ€è¿‘å®Œæˆçš„ä»»åŠ¡ï¼ˆæœ€å¤š 20 æ¡ï¼‰

  // Actions
  addTask(task: Task): void
  updateTask(jobId: string, updates: Partial<Task>): void
  updateTaskProgress(jobId: string, progress: number, extraData?: object): void
  deleteTask(jobId: string): void
  reorderQueue(newOrder: string[]): Promise<void>
  checkSSEConnection(): void
  syncTasksFromBackend(): Promise<void>
}
```

### 3.3 å…³é”®é€»è¾‘

```javascript
// 1. Processing ä»»åŠ¡ï¼ˆå•ä¾‹ï¼‰
const processingTask = computed(() => {
  const tasks = Array.from(tasksMap.values()).filter(t => t.status === 'processing')
  return tasks.length > 0 ? tasks[0] : null  // æœ€å¤šè¿”å› 1 ä¸ª
})

// 2. é˜Ÿåˆ—ä»»åŠ¡ï¼ˆä¸¥æ ¼æŒ‰åç«¯é¡ºåºï¼‰
const queuedTasks = computed(() => {
  return queueOrder.value
    .map(id => tasksMap.value.get(id))
    .filter(t => t && t.status === 'queued')
})

// 3. å†å²ä»»åŠ¡ï¼ˆé™åˆ¶æ•°é‡ï¼‰
const recentFinishedTasks = computed(() =>
  Array.from(tasksMap.values())
    .filter(t => t.status === 'finished')
    .sort((a, b) => b.completed_at - a.completed_at)
    .slice(0, 20)  // åªå–å‰ 20 æ¡
)

// 4. SSE å¿ƒè·³æ£€æµ‹
function checkSSEConnection() {
  if (Date.now() - lastHeartbeat.value > 30000) {  // 30 ç§’æ— å¿ƒè·³
    sseConnected.value = false
    console.warn('[TaskStore] SSE è¿æ¥è¶…æ—¶')
  }
}

// å®šæœŸæ£€æµ‹ï¼ˆåœ¨ç»„ä»¶ mounted æ—¶å¯åŠ¨ï¼‰
setInterval(checkSSEConnection, 5000)
```

---

## 4. ç»„ä»¶è®¾è®¡

### 4.1 ç»„ä»¶æ ‘

```
TaskMonitor
â”œâ”€â”€ ProcessingArea (å›ºå®šåŒºåŸŸ)
â”‚   â””â”€â”€ TaskCard (æœ€å¤š 1 ä¸ª)
â”‚
â”œâ”€â”€ ScrollableBody (æ»šåŠ¨åŒºåŸŸ)
â”‚   â”œâ”€â”€ SSEAlert (æ¡ä»¶æ¸²æŸ“)
â”‚   â”œâ”€â”€ TaskGroup (å¤±è´¥ä»»åŠ¡)
â”‚   â”‚   â””â”€â”€ TaskCard (å¤šä¸ª)
â”‚   â”œâ”€â”€ TaskGroup (æ’é˜Ÿä¸­) **å¯æ‹–åŠ¨**
â”‚   â”‚   â””â”€â”€ Draggable
â”‚   â”‚       â””â”€â”€ TaskCard (å¤šä¸ª)
â”‚   â”œâ”€â”€ TaskGroup (å·²æš‚åœ)
â”‚   â”‚   â””â”€â”€ TaskCard (å¤šä¸ª)
â”‚   â””â”€â”€ TaskGroup (æœ€è¿‘å®Œæˆ)
â”‚       â”œâ”€â”€ TaskCard (æœ€å¤š 20 ä¸ª)
â”‚       â””â”€â”€ ViewMoreButton
â”‚
â””â”€â”€ GradientMask (åº•éƒ¨é®ç½©)
```

### 4.2 æ ¸å¿ƒç»„ä»¶è§„æ ¼

#### 4.2.1 TaskMonitor (ä¸»å®¹å™¨)

```vue
<template>
  <div class="task-monitor">
    <!-- å›ºå®šåŒºï¼šProcessing ä»»åŠ¡ -->
    <div class="monitor-header">
      <TransitionGroup name="list">
        <TaskCard
          v-if="processingTask"
          :key="processingTask.job_id"
          :task="processingTask"
          variant="processing"
        />
      </TransitionGroup>

      <!-- æ— ä»»åŠ¡æ—¶çš„ç©ºçŠ¶æ€ -->
      <div v-if="!processingTask && !hasAnyTasks" class="empty-state">
        <svg>...</svg>
        <p>æš‚æ— åå°ä»»åŠ¡</p>
      </div>
    </div>

    <!-- æ»šåŠ¨åŒºï¼šä»»åŠ¡åˆ†ç»„ -->
    <div class="monitor-body" ref="scrollContainer">
      <!-- SSE æ–­å¼€è­¦å‘Š -->
      <div v-if="!sseConnected" class="sse-alert">
        âš ï¸ å®æ—¶è¿æ¥å·²æ–­å¼€ï¼Œæ­£åœ¨å°è¯•é‡è¿...
      </div>

      <!-- å¤±è´¥ä»»åŠ¡ -->
      <TaskGroup
        title="å¤±è´¥"
        :count="failedTasks.length"
        variant="danger"
        :defaultCollapsed="true"
      >
        <TaskCard
          v-for="task in failedTasks"
          :key="task.job_id"
          :task="task"
        />
      </TaskGroup>

      <!-- æ’é˜Ÿä¸­ï¼ˆå¯æ‹–åŠ¨ï¼‰ -->
      <TaskGroup
        title="æ’é˜Ÿä¸­"
        :count="queuedTasks.length"
        variant="primary"
        :defaultCollapsed="false"
      >
        <Draggable
          v-model="queuedTasks"
          item-key="job_id"
          :animation="200"
          ghost-class="task-ghost"
          handle=".drag-handle"
          :scroll-sensitivity="80"
          :scroll-speed="20"
          @end="handleDragEnd"
        >
          <template #item="{ element }">
            <TaskCard :task="element" :draggable="true" />
          </template>
        </Draggable>
      </TaskGroup>

      <!-- å·²æš‚åœ -->
      <TaskGroup
        title="å·²æš‚åœ"
        :count="pausedTasks.length"
        variant="warning"
        :defaultCollapsed="true"
      >
        <TaskCard
          v-for="task in pausedTasks"
          :key="task.job_id"
          :task="task"
        />
      </TaskGroup>

      <!-- æœ€è¿‘å®Œæˆ -->
      <TaskGroup
        title="æœ€è¿‘å®Œæˆ"
        :count="finishedTasks.length"
        variant="success"
        :defaultCollapsed="true"
      >
        <TransitionGroup name="list">
          <TaskCard
            v-for="task in recentFinishedTasks"
            :key="task.job_id"
            :task="task"
            :class="{ 'newly-finished': task.isNewlyFinished }"
          />
        </TransitionGroup>

        <div class="view-more" @click="openHistoryPage">
          æŸ¥çœ‹å…¨éƒ¨å†å²è®°å½• >
        </div>
      </TaskGroup>
    </div>

    <!-- åº•éƒ¨æ¸å˜é®ç½© -->
    <div class="gradient-mask"></div>
  </div>
</template>

<script setup>
import { computed, ref, onMounted, onUnmounted } from 'vue'
import { useUnifiedTaskStore } from '@/stores/unifiedTaskStore'
import Draggable from 'vuedraggable'
import TaskGroup from './TaskGroup.vue'
import TaskCard from './TaskCard.vue'

const taskStore = useUnifiedTaskStore()

// ä» store è·å–æ•°æ®
const processingTask = computed(() => taskStore.processingTask)
const queuedTasks = computed(() => taskStore.queuedTasks)
const failedTasks = computed(() => taskStore.failedTasks)
const pausedTasks = computed(() => taskStore.pausedTasks)
const recentFinishedTasks = computed(() => taskStore.recentFinishedTasks)
const sseConnected = computed(() => taskStore.sseConnected)

const hasAnyTasks = computed(() =>
  taskStore.tasks.length > 0
)

// æ‹–åŠ¨ç»“æŸå¤„ç†
async function handleDragEnd(event) {
  if (event.oldIndex === event.newIndex) return

  const newOrder = queuedTasks.value.map(t => t.job_id)
  await taskStore.reorderQueue(newOrder)
}

// æ‰“å¼€å†å²è®°å½•é¡µé¢
function openHistoryPage() {
  // è·³è½¬åˆ°ç‹¬ç«‹çš„å†å²è®°å½•é¡µé¢
  router.push('/history')
}

// SSE å¿ƒè·³æ£€æµ‹
let heartbeatTimer = null
onMounted(() => {
  heartbeatTimer = setInterval(() => {
    taskStore.checkSSEConnection()
  }, 5000)
})

onUnmounted(() => {
  if (heartbeatTimer) {
    clearInterval(heartbeatTimer)
  }
})
</script>

<style lang="scss" scoped>
.task-monitor {
  display: flex;
  flex-direction: column;
  height: 100%;
  background: var(--bg-secondary);
  position: relative;
}

.monitor-header {
  flex-shrink: 0;
  background: var(--bg-primary);
  border-bottom: 1px solid var(--border-default);
  max-height: 300px;
  overflow-y: auto;
  padding: 12px;
  box-shadow: var(--shadow-sm);
  z-index: 10;
}

.monitor-body {
  flex: 1;
  overflow-y: auto;
  padding: 12px;
  padding-bottom: 64px;  // ä¸ºæ¸å˜é®ç½©ç•™ç©ºé—´

  &::-webkit-scrollbar {
    width: 8px;
  }
  &::-webkit-scrollbar-thumb {
    background: var(--border-muted);
    border-radius: 4px;
  }
}

.gradient-mask {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 48px;
  background: linear-gradient(to top, var(--bg-secondary), transparent);
  pointer-events: none;
}

.sse-alert {
  background: rgba(248, 81, 73, 0.1);
  color: var(--danger);
  padding: 12px;
  border-radius: 6px;
  margin-bottom: 12px;
  font-size: 13px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 48px 24px;
  color: var(--text-muted);

  svg {
    width: 48px;
    height: 48px;
    opacity: 0.5;
    margin-bottom: 12px;
  }

  p {
    font-size: 13px;
    margin: 0;
  }
}

.view-more {
  text-align: center;
  padding: 8px;
  font-size: 12px;
  color: var(--text-muted);
  cursor: pointer;

  &:hover {
    color: var(--primary);
  }
}

// Vue TransitionGroup åŠ¨ç”»
.list-move,
.list-enter-active,
.list-leave-active {
  transition: all 0.3s ease;
}

.list-enter-from,
.list-leave-to {
  opacity: 0;
  transform: translateY(-10px);
}

.list-leave-active {
  position: absolute;
  width: 100%;
}

// æ–°å®Œæˆä»»åŠ¡é«˜äº®
.newly-finished {
  animation: highlight 2s ease-out;
}

@keyframes highlight {
  0%, 100% { background: transparent; }
  50% { background: rgba(63, 185, 80, 0.15); }
}
</style>
```

#### 4.2.2 TaskGroup (æŠ˜å ç»„ä»¶)

```vue
<template>
  <div class="task-group" :class="`variant-${variant}`">
    <!-- æ ‡é¢˜æ  -->
    <div class="group-header" @click="toggleCollapse">
      <div class="header-left">
        <span class="status-dot"></span>
        <span class="group-title">{{ title }}</span>
        <span class="group-count">({{ count }})</span>
      </div>
      <div class="header-right">
        <svg
          class="collapse-icon"
          :class="{ collapsed: isCollapsed }"
          viewBox="0 0 24 24"
        >
          <path d="M7 10l5 5 5-5z"/>
        </svg>
      </div>
    </div>

    <!-- å†…å®¹åŒºï¼ˆä½¿ç”¨ CSS Grid æŠ˜å ï¼‰ -->
    <div
      class="group-content-wrapper"
      :class="{ collapsed: isCollapsed }"
    >
      <div class="group-content">
        <slot></slot>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'

const props = defineProps({
  title: String,
  count: { type: Number, default: 0 },
  variant: {
    type: String,
    default: 'default',
    validator: (v) => ['default', 'primary', 'success', 'warning', 'danger'].includes(v)
  },
  defaultCollapsed: { type: Boolean, default: false }
})

const isCollapsed = ref(props.defaultCollapsed)

function toggleCollapse() {
  isCollapsed.value = !isCollapsed.value
}
</script>

<style lang="scss" scoped>
.task-group {
  background: var(--bg-tertiary);
  border: 1px solid var(--border-default);
  border-radius: 8px;
  margin-bottom: 12px;
  overflow: hidden;
}

.group-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  cursor: pointer;
  user-select: none;
  transition: background 0.2s;

  &:hover {
    background: var(--bg-elevated);
  }

  .header-left {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--text-muted);
  }

  .group-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--text-primary);
  }

  .group-count {
    font-size: 12px;
    color: var(--text-muted);
  }

  .collapse-icon {
    width: 20px;
    height: 20px;
    color: var(--text-muted);
    transition: transform 0.3s ease;

    &.collapsed {
      transform: rotate(-90deg);
    }
  }
}

// CSS Grid æŠ˜å åŠ¨ç”»
.group-content-wrapper {
  display: grid;
  grid-template-rows: 1fr;
  transition: grid-template-rows 300ms ease-out;

  &.collapsed {
    grid-template-rows: 0fr;
  }
}

.group-content {
  overflow: hidden;
  padding: 0 12px 12px;
}

// å˜ä½“æ ·å¼
.variant-primary .status-dot { background: var(--primary); }
.variant-success .status-dot { background: var(--success); }
.variant-warning .status-dot { background: var(--warning); }
.variant-danger .status-dot { background: var(--danger); }
</style>
```

#### 4.2.3 TaskCard (ä»»åŠ¡å¡ç‰‡)

```vue
<template>
  <div
    class="task-card"
    :class="[
      `variant-${variant}`,
      { 'is-draggable': draggable }
    ]"
  >
    <!-- æ‹–åŠ¨æ‰‹æŸ„ -->
    <div v-if="draggable" class="drag-handle" title="æ‹–åŠ¨æ’åº">
      <svg viewBox="0 0 24 24">
        <path d="M11 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm-2-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
      </svg>
    </div>

    <!-- ä»»åŠ¡ä¿¡æ¯ -->
    <div class="task-info">
      <div class="task-header">
        <span class="task-name">{{ task.title || task.filename }}</span>
        <span
          class="task-phase"
          :style="{
            background: getPhaseStyle(task).bgColor,
            color: getPhaseStyle(task).color
          }"
        >
          {{ getPhaseLabel(task) }}
        </span>
      </div>

      <!-- è¿›åº¦æ¡ -->
      <div v-if="showProgress" class="task-progress">
        <div class="progress-bar">
          <div
            class="progress-fill"
            :style="{ width: task.progress + '%' }"
          ></div>
        </div>
        <span class="progress-text">{{ task.progress.toFixed(1) }}%</span>
      </div>

      <!-- é”™è¯¯ä¿¡æ¯ -->
      <div v-if="task.status === 'failed'" class="task-error">
        <svg viewBox="0 0 24 24">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
        </svg>
        <span>{{ task.message || 'è½¬å½•å¤±è´¥' }}</span>
      </div>

      <!-- å®Œæˆæ—¶é—´ -->
      <div v-if="task.status === 'finished'" class="task-meta">
        <svg viewBox="0 0 24 24">
          <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
        </svg>
        <span>{{ formatTime(task.completed_at) }}</span>
      </div>
    </div>

    <!-- æ“ä½œæŒ‰é’® -->
    <div class="task-actions">
      <button
        v-if="task.status === 'processing'"
        class="action-btn"
        @click="pauseTask"
        title="æš‚åœ"
      >
        <svg viewBox="0 0 24 24">
          <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
        </svg>
      </button>

      <button
        v-if="task.status === 'paused'"
        class="action-btn action-btn--success"
        @click="resumeTask"
        title="æ¢å¤"
      >
        <svg viewBox="0 0 24 24">
          <path d="M8 5v14l11-7z"/>
        </svg>
      </button>

      <button
        v-if="['processing', 'queued', 'paused'].includes(task.status)"
        class="action-btn action-btn--danger"
        @click="cancelTask"
        title="å–æ¶ˆ"
      >
        <svg viewBox="0 0 24 24">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>

      <button
        v-if="task.status === 'finished'"
        class="action-btn action-btn--primary"
        @click="openEditor"
        title="æ‰“å¼€ç¼–è¾‘å™¨"
      >
        <svg viewBox="0 0 24 24">
          <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
        </svg>
      </button>
    </div>
  </div>
</template>

<script setup>
import { computed } from 'vue'
import { useRouter } from 'vue-router'
import { transcriptionApi } from '@/services/api'
import { PHASE_CONFIG, STATUS_CONFIG } from '@/constants/taskPhases'

const props = defineProps({
  task: { type: Object, required: true },
  variant: { type: String, default: 'default' },
  draggable: { type: Boolean, default: false }
})

const router = useRouter()

const showProgress = computed(() =>
  ['processing', 'queued', 'paused'].includes(props.task.status)
)

function getPhaseStyle(task) {
  if (task.status === 'failed') return STATUS_CONFIG.failed
  if (task.status === 'processing' && task.phase) {
    return PHASE_CONFIG[task.phase] || PHASE_CONFIG.pending
  }
  return STATUS_CONFIG[task.status] || STATUS_CONFIG.created
}

function getPhaseLabel(task) {
  if (task.status === 'failed') return 'å¤±è´¥'
  if (task.status === 'processing' && task.phase) {
    return PHASE_CONFIG[task.phase]?.label || 'å¤„ç†ä¸­'
  }
  return STATUS_CONFIG[task.status]?.label || task.status
}

async function pauseTask() {
  await transcriptionApi.pauseJob(props.task.job_id)
}

async function resumeTask() {
  await transcriptionApi.resumeJob(props.task.job_id)
}

async function cancelTask() {
  if (!confirm('ç¡®å®šè¦å–æ¶ˆè¿™ä¸ªä»»åŠ¡å—?')) return
  await transcriptionApi.cancelJob(props.task.job_id, false)
}

function openEditor() {
  router.push(`/editor/${props.task.job_id}`)
}

function formatTime(timestamp) {
  if (!timestamp) return ''
  const date = new Date(timestamp)
  const now = new Date()
  const diff = now - date

  if (diff < 60000) return 'åˆšåˆš'
  if (diff < 3600000) return `${Math.floor(diff / 60000)} åˆ†é’Ÿå‰`
  if (diff < 86400000) return `${Math.floor(diff / 3600000)} å°æ—¶å‰`
  return date.toLocaleDateString('zh-CN')
}
</script>

<style lang="scss" scoped>
.task-card {
  display: flex;
  gap: 12px;
  padding: 12px;
  background: var(--bg-primary);
  border: 1px solid var(--border-default);
  border-radius: 6px;
  margin-bottom: 8px;
  transition: all 0.2s;

  &:hover {
    background: var(--bg-elevated);
  }

  &.is-draggable {
    cursor: move;
  }
}

.drag-handle {
  width: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-muted);
  cursor: grab;
  opacity: 0.5;

  &:hover {
    opacity: 1;
  }

  &:active {
    cursor: grabbing;
  }

  svg {
    width: 16px;
    height: 16px;
  }
}

.task-info {
  flex: 1;
  min-width: 0;
}

.task-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 8px;
  gap: 8px;
}

.task-name {
  flex: 1;
  font-size: 13px;
  font-weight: 500;
  color: var(--text-primary);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.task-phase {
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 10px;
  font-weight: 600;
  white-space: nowrap;
}

.task-progress {
  display: flex;
  align-items: center;
  gap: 8px;
}

.progress-bar {
  flex: 1;
  height: 4px;
  background: var(--border-muted);
  border-radius: 2px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: var(--primary);
  transition: width 0.3s ease;
}

.progress-text {
  font-size: 11px;
  font-family: var(--font-mono);
  color: var(--text-muted);
  min-width: 35px;
  text-align: right;
}

.task-error {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 11px;
  color: var(--danger);

  svg {
    width: 14px;
    height: 14px;
  }
}

.task-meta {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 11px;
  color: var(--text-muted);

  svg {
    width: 14px;
    height: 14px;
    color: var(--success);
  }
}

.task-actions {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.action-btn {
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  border-radius: 4px;
  color: var(--text-muted);
  cursor: pointer;
  transition: all 0.2s;

  svg {
    width: 16px;
    height: 16px;
  }

  &:hover {
    background: var(--bg-tertiary);
    color: var(--text-secondary);
  }

  &--primary {
    color: var(--primary);
    &:hover {
      background: rgba(88, 166, 255, 0.15);
    }
  }

  &--success {
    color: var(--success);
    &:hover {
      background: rgba(63, 185, 80, 0.15);
    }
  }

  &--danger:hover {
    background: rgba(248, 81, 73, 0.15);
    color: var(--danger);
  }
}

// æ‹–åŠ¨å ä½ç¬¦æ ·å¼
.task-ghost {
  opacity: 0.5;
  background: var(--bg-tertiary);
  border: 2px dashed var(--border-default);
}
</style>
```

---

## 5. æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### 5.1 Store å®ç° (unifiedTaskStore.js)

```javascript
import { defineStore } from 'pinia'
import { ref, computed, reactive } from 'vue'
import { transcriptionApi } from '@/services/api'

export const useUnifiedTaskStore = defineStore('unifiedTask', () => {
  // ========== æ ¸å¿ƒæ•°æ® ==========
  const tasksMap = reactive(new Map())  // ID -> Task
  const queueOrder = ref([])            // é˜Ÿåˆ—é¡ºåº [jobId1, jobId2, ...]

  // ========== SSE çŠ¶æ€ ==========
  const sseConnected = ref(false)
  const lastHeartbeat = ref(Date.now())

  // ========== è®¡ç®—å±æ€§ ==========

  // æ‰€æœ‰ä»»åŠ¡ï¼ˆæ•°ç»„å½¢å¼ï¼Œç”¨äºéå†ï¼‰
  const tasks = computed(() => Array.from(tasksMap.values()))

  // Processing ä»»åŠ¡ï¼ˆæœ€å¤š 1 ä¸ªï¼‰
  const processingTask = computed(() => {
    const processing = tasks.value.filter(t => t.status === 'processing')
    return processing.length > 0 ? processing[0] : null
  })

  // æ’é˜Ÿä»»åŠ¡ï¼ˆä¸¥æ ¼æŒ‰ queueOrder æ’åºï¼‰
  const queuedTasks = computed(() => {
    return queueOrder.value
      .map(id => tasksMap.get(id))
      .filter(t => t && t.status === 'queued')
  })

  // å¤±è´¥ä»»åŠ¡ï¼ˆæŒ‰å¤±è´¥æ—¶é—´å€’åºï¼‰
  const failedTasks = computed(() =>
    tasks.value
      .filter(t => t.status === 'failed')
      .sort((a, b) => (b.failed_at || b.updated_at) - (a.failed_at || a.updated_at))
  )

  // æš‚åœä»»åŠ¡ï¼ˆæŒ‰æš‚åœæ—¶é—´å€’åºï¼‰
  const pausedTasks = computed(() =>
    tasks.value
      .filter(t => t.status === 'paused')
      .sort((a, b) => (b.paused_at || b.updated_at) - (a.paused_at || a.updated_at))
  )

  // æœ€è¿‘å®Œæˆä»»åŠ¡ï¼ˆæœ€å¤š 20 æ¡ï¼‰
  const recentFinishedTasks = computed(() =>
    tasks.value
      .filter(t => t.status === 'finished')
      .sort((a, b) => (b.completed_at || b.updated_at) - (a.completed_at || a.updated_at))
      .slice(0, 20)
  )

  // ========== Actions ==========

  /**
   * æ·»åŠ ä»»åŠ¡
   */
  function addTask(taskData) {
    const task = {
      job_id: taskData.job_id,
      filename: taskData.filename,
      title: taskData.title || null,
      status: taskData.status || 'created',
      progress: taskData.progress || 0,
      phase: taskData.phase || null,
      phase_percent: taskData.phase_percent || 0,
      message: taskData.message || '',
      created_at: taskData.created_at || Date.now(),
      updated_at: Date.now(),
      completed_at: taskData.completed_at || null,
      paused_at: taskData.paused_at || null,
      failed_at: taskData.failed_at || null,
      sseConnected: false,
      lastError: null,
      isNewlyFinished: false
    }

    tasksMap.set(task.job_id, task)
    saveTasks()
  }

  /**
   * æ›´æ–°ä»»åŠ¡
   */
  function updateTask(jobId, updates) {
    const task = tasksMap.get(jobId)
    if (!task) return

    // æ£€æµ‹ä»»åŠ¡æ˜¯å¦åˆšå®Œæˆ
    if (updates.status === 'finished' && task.status !== 'finished') {
      updates.isNewlyFinished = true
      updates.completed_at = Date.now()

      // 2 ç§’åç§»é™¤é«˜äº®
      setTimeout(() => {
        const t = tasksMap.get(jobId)
        if (t) {
          t.isNewlyFinished = false
        }
      }, 2000)
    }

    // æ›´æ–°æ—¶é—´æˆ³
    if (updates.status === 'paused' && task.status !== 'paused') {
      updates.paused_at = Date.now()
    }
    if (updates.status === 'failed' && task.status !== 'failed') {
      updates.failed_at = Date.now()
    }

    Object.assign(task, updates, { updated_at: Date.now() })
    saveTasks()
  }

  /**
   * æ›´æ–°ä»»åŠ¡è¿›åº¦
   */
  function updateTaskProgress(jobId, progress, extraData = {}) {
    const task = tasksMap.get(jobId)
    if (!task) return

    task.progress = Math.round(progress * 10) / 10

    if (extraData.phase) task.phase = extraData.phase
    if (extraData.phase_percent !== undefined) {
      task.phase_percent = Math.round(extraData.phase_percent * 10) / 10
    }
    if (extraData.message) task.message = extraData.message

    task.sseConnected = true
    task.lastError = null
    task.updated_at = Date.now()
  }

  /**
   * åˆ é™¤ä»»åŠ¡
   */
  function deleteTask(jobId) {
    tasksMap.delete(jobId)
    queueOrder.value = queueOrder.value.filter(id => id !== jobId)
    saveTasks()
  }

  /**
   * é‡æ–°æ’åºé˜Ÿåˆ—
   */
  async function reorderQueue(newOrder) {
    const oldOrder = [...queueOrder.value]

    // ä¹è§‚æ›´æ–°
    queueOrder.value = newOrder

    try {
      const result = await transcriptionApi.reorderQueue(newOrder)
      if (!result.reordered) {
        // æ¢å¤åŸé¡ºåº
        queueOrder.value = oldOrder
        console.error('[TaskStore] é˜Ÿåˆ—é‡æ’å¤±è´¥')
      }
    } catch (error) {
      // æ¢å¤åŸé¡ºåº
      queueOrder.value = oldOrder
      console.error('[TaskStore] é˜Ÿåˆ—é‡æ’è¯·æ±‚å¤±è´¥:', error)
      throw error
    }
  }

  /**
   * æ£€æŸ¥ SSE è¿æ¥çŠ¶æ€
   */
  function checkSSEConnection() {
    if (Date.now() - lastHeartbeat.value > 30000) {  // 30 ç§’æ— å¿ƒè·³
      sseConnected.value = false
    }
  }

  /**
   * æ›´æ–° SSE å¿ƒè·³
   */
  function updateSSEHeartbeat() {
    lastHeartbeat.value = Date.now()
    sseConnected.value = true
  }

  /**
   * åŒæ­¥åç«¯ä»»åŠ¡åˆ—è¡¨
   */
  async function syncTasksFromBackend() {
    try {
      const response = await transcriptionApi.syncTasks()
      if (!response.success) return false

      const backendTasks = response.tasks || []
      const backendTaskIds = new Set(backendTasks.map(t => t.id))

      // åˆ é™¤å‰ç«¯æœ‰ä½†åç«¯æ²¡æœ‰çš„ä»»åŠ¡ï¼ˆå¹½çµä»»åŠ¡ï¼‰
      for (const [localId, task] of tasksMap) {
        if (!backendTaskIds.has(localId)) {
          tasksMap.delete(localId)
        }
      }

      // æ›´æ–°æˆ–æ·»åŠ åç«¯ä»»åŠ¡
      for (const backendTask of backendTasks) {
        const existingTask = tasksMap.get(backendTask.id)
        if (existingTask) {
          // æ›´æ–°ç°æœ‰ä»»åŠ¡
          Object.assign(existingTask, {
            status: backendTask.status,
            progress: backendTask.progress,
            phase: backendTask.phase,
            phase_percent: backendTask.phase_percent || 0,
            message: backendTask.message,
            updated_at: Date.now()
          })
        } else {
          // æ·»åŠ æ–°ä»»åŠ¡
          addTask({
            job_id: backendTask.id,
            filename: backendTask.filename,
            title: backendTask.title,
            status: backendTask.status,
            progress: backendTask.progress,
            phase: backendTask.phase,
            phase_percent: backendTask.phase_percent || 0,
            message: backendTask.message,
            created_at: backendTask.created_time || Date.now()
          })
        }
      }

      // æ›´æ–°é˜Ÿåˆ—é¡ºåº
      if (response.queue) {
        queueOrder.value = response.queue
      }

      saveTasks()
      return true
    } catch (error) {
      console.error('[TaskStore] åŒæ­¥ä»»åŠ¡å¤±è´¥:', error)
      return false
    }
  }

  /**
   * æŒä¹…åŒ–åˆ° localStorage
   */
  function saveTasks() {
    try {
      const tasksArray = Array.from(tasksMap.values())
      localStorage.setItem('task-list', JSON.stringify(tasksArray))
      localStorage.setItem('queue-order', JSON.stringify(queueOrder.value))
    } catch (error) {
      console.error('[TaskStore] ä¿å­˜ä»»åŠ¡å¤±è´¥:', error)
    }
  }

  /**
   * ä» localStorage æ¢å¤
   */
  function restoreTasks() {
    try {
      const saved = localStorage.getItem('task-list')
      if (saved) {
        const tasksArray = JSON.parse(saved)
        tasksMap.clear()
        tasksArray.forEach(t => tasksMap.set(t.job_id, t))
      }

      const savedOrder = localStorage.getItem('queue-order')
      if (savedOrder) {
        queueOrder.value = JSON.parse(savedOrder)
      }
    } catch (error) {
      console.error('[TaskStore] æ¢å¤ä»»åŠ¡å¤±è´¥:', error)
    }
  }

  // åˆå§‹åŒ–
  restoreTasks()

  return {
    // çŠ¶æ€
    tasksMap,
    queueOrder,
    sseConnected,
    lastHeartbeat,

    // è®¡ç®—å±æ€§
    tasks,
    processingTask,
    queuedTasks,
    failedTasks,
    pausedTasks,
    recentFinishedTasks,

    // æ–¹æ³•
    addTask,
    updateTask,
    updateTaskProgress,
    deleteTask,
    reorderQueue,
    checkSSEConnection,
    updateSSEHeartbeat,
    syncTasksFromBackend,
    saveTasks,
    restoreTasks
  }
})
```

### 5.2 SSE é›†æˆ (sseChannelManager.js ä¿®æ”¹)

```javascript
// åœ¨ subscribeGlobal ä¸­æ·»åŠ å¿ƒè·³å¤„ç†
subscribeGlobal(handlers = {}) {
  const channelId = 'global'
  const url = `${this.baseURL}/api/events/global`

  return this._subscribe(channelId, url, {
    // ... å…¶ä»–äº‹ä»¶å¤„ç†å™¨

    ping: () => {
      // æ›´æ–°å¿ƒè·³æ—¶é—´
      const taskStore = useUnifiedTaskStore()
      taskStore.updateSSEHeartbeat()
    },

    connected: (data) => {
      const taskStore = useUnifiedTaskStore()
      taskStore.updateSSEHeartbeat()
      handlers.onConnected?.(data)
    }
  })
}
```

### 5.3 æ‹–åŠ¨æ’åºé…ç½®

```javascript
// å®‰è£…ä¾èµ–
npm install vuedraggable@next

// åœ¨ç»„ä»¶ä¸­é…ç½®
<Draggable
  v-model="queuedTasks"
  item-key="job_id"
  :animation="200"              // åŠ¨ç”»æ—¶é•¿
  ghost-class="task-ghost"      // å ä½ç¬¦æ ·å¼
  handle=".drag-handle"         // æ‹–åŠ¨æ‰‹æŸ„
  :scroll-sensitivity="80"      // æ»šåŠ¨çµæ•åº¦
  :scroll-speed="20"            // æ»šåŠ¨é€Ÿåº¦
  :force-fallback="true"        // å¼ºåˆ¶ä½¿ç”¨ fallbackï¼ˆå…¼å®¹æ€§ï¼‰
  @end="handleDragEnd"
>
```

---

## 6. ä»£ç ä¿®æ”¹æ¸…å•

### 6.1 éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | ä¿®æ”¹ç±»å‹ | ä¼˜å…ˆçº§ |
|---------|---------|--------|
| `frontend/src/stores/unifiedTaskStore.js` | é‡æ„ | P0 |
| `frontend/src/components/editor/TaskMonitor/index.vue` | é‡æ„ | P0 |
| `frontend/src/components/editor/TaskMonitor/TaskGroup.vue` | æ–°å»º | P0 |
| `frontend/src/components/editor/TaskMonitor/TaskCard.vue` | æ–°å»º | P0 |
| `frontend/src/services/sseChannelManager.js` | ä¿®æ”¹ | P1 |
| `frontend/src/views/TaskListView.vue` | ä¿®æ”¹ | P1 |
| `frontend/package.json` | æ·»åŠ ä¾èµ– | P0 |

### 6.2 è¯¦ç»†ä¿®æ”¹å†…å®¹

#### 6.2.1 unifiedTaskStore.js

**éœ€è¦ç§»é™¤çš„ä»£ç ï¼š**
```javascript
// âŒ ç§»é™¤ï¼šå¤šä»»åŠ¡å¤„ç†ç›¸å…³
const processingTasks = computed(() =>
  tasks.value.filter(t => t.status === 'processing')  // è¿”å›æ•°ç»„
)

// âŒ ç§»é™¤ï¼šactiveCountï¼ˆç³»ç»Ÿåªå…è®¸ 1 ä¸ªä»»åŠ¡è¿è¡Œï¼‰
const activeCount = computed(() =>
  tasks.value.filter(t => ['queued', 'processing'].includes(t.status)).length
)
```

**éœ€è¦æ·»åŠ çš„ä»£ç ï¼š**
```javascript
// âœ… æ·»åŠ ï¼šå•ä»»åŠ¡å¤„ç†
const processingTask = computed(() => {
  const processing = tasks.value.filter(t => t.status === 'processing')
  return processing.length > 0 ? processing[0] : null  // è¿”å›å•ä¸ªå¯¹è±¡æˆ– null
})

// âœ… æ·»åŠ ï¼šé˜Ÿåˆ—é¡ºåºç´¢å¼•
const queueOrder = ref([])

// âœ… æ·»åŠ ï¼šä¸¥æ ¼æŒ‰é˜Ÿåˆ—é¡ºåºæ’åº
const queuedTasks = computed(() => {
  return queueOrder.value
    .map(id => tasksMap.get(id))
    .filter(t => t && t.status === 'queued')
})

// âœ… æ·»åŠ ï¼šSSE å¿ƒè·³æ£€æµ‹
const sseConnected = ref(false)
const lastHeartbeat = ref(Date.now())

function checkSSEConnection() {
  if (Date.now() - lastHeartbeat.value > 30000) {
    sseConnected.value = false
  }
}

function updateSSEHeartbeat() {
  lastHeartbeat.value = Date.now()
  sseConnected.value = true
}

// âœ… æ·»åŠ ï¼šä»»åŠ¡å®Œæˆé«˜äº®
function updateTask(jobId, updates) {
  const task = tasksMap.get(jobId)
  if (!task) return

  if (updates.status === 'finished' && task.status !== 'finished') {
    updates.isNewlyFinished = true
    setTimeout(() => {
      const t = tasksMap.get(jobId)
      if (t) t.isNewlyFinished = false
    }, 2000)
  }

  Object.assign(task, updates, { updated_at: Date.now() })
}

// âœ… æ·»åŠ ï¼šé™åˆ¶å†å²è®°å½•æ•°é‡
const recentFinishedTasks = computed(() =>
  tasks.value
    .filter(t => t.status === 'finished')
    .sort((a, b) => b.completed_at - a.completed_at)
    .slice(0, 20)  // åªå–å‰ 20 æ¡
)
```

#### 6.2.2 TaskMonitor/index.vue

**å®Œå…¨é‡æ„ï¼Œä¸»è¦å˜æ›´ï¼š**

1. **å¸ƒå±€ç»“æ„**
   ```vue
   <!-- æ—§ç‰ˆï¼šæ‰€æœ‰ä»»åŠ¡æ··åœ¨ä¸€èµ· -->
   <div class="task-list">
     <div v-for="task in filteredTasks" ...>
   </div>
   
   <!-- æ–°ç‰ˆï¼šåˆ†åŒºåŸŸå¸ƒå±€ -->
   <div class="monitor-header">
     <!-- Processing ä»»åŠ¡åŒºåŸŸï¼ˆå›ºå®šï¼‰ -->
   </div>
   <div class="monitor-body">
     <!-- ä»»åŠ¡åˆ†ç»„åŒºåŸŸï¼ˆå¯æ»šåŠ¨ï¼‰ -->
   </div>
   <div class="gradient-mask"></div>
   ```

2. **æ•°æ®ç»‘å®š**
   ```javascript
   // æ—§ç‰ˆ
   const filteredTasks = computed(() =>
     taskStore.tasks.filter(t => t.status !== 'created')
   )
   
   // æ–°ç‰ˆ
   const processingTask = computed(() => taskStore.processingTask)
   const queuedTasks = computed(() => taskStore.queuedTasks)
   const failedTasks = computed(() => taskStore.failedTasks)
   const pausedTasks = computed(() => taskStore.pausedTasks)
   const recentFinishedTasks = computed(() => taskStore.recentFinishedTasks)
   ```

3. **æ‹–åŠ¨æ’åº**
   ```vue
   <!-- æ—§ç‰ˆï¼šç›´æ¥åœ¨ä»»åŠ¡åˆ—è¡¨ä¸Šæ‹–åŠ¨ -->
   <draggable v-model="queuedTasks" ...>
   
   <!-- æ–°ç‰ˆï¼šåªåœ¨ Queued åˆ†ç»„å†…æ‹–åŠ¨ -->
   <TaskGroup title="æ’é˜Ÿä¸­">
     <Draggable v-model="queuedTasks" ...>
   </TaskGroup>
   ```

#### 6.2.3 æ–°å»ºç»„ä»¶

**TaskGroup.vue**
- å®ç°æŠ˜å å±•å¼€åŠŸèƒ½
- ä½¿ç”¨ CSS Grid åŠ¨ç”»
- æ”¯æŒä¸åŒçš„è§†è§‰å˜ä½“ï¼ˆprimary/success/warning/dangerï¼‰

**TaskCard.vue**
- ä» TaskMonitor/index.vue ä¸­æå–ä»»åŠ¡å¡ç‰‡é€»è¾‘
- æ”¯æŒæ‹–åŠ¨æ‰‹æŸ„
- æ”¯æŒä¸åŒçš„æ˜¾ç¤ºæ¨¡å¼ï¼ˆprocessing/queued/finishedï¼‰

#### 6.2.4 sseChannelManager.js

**æ·»åŠ å¿ƒè·³å¤„ç†ï¼š**
```javascript
subscribeGlobal(handlers = {}) {
  return this._subscribe(channelId, url, {
    // ... ç°æœ‰äº‹ä»¶å¤„ç†å™¨

    ping: () => {
      // æ–°å¢ï¼šæ›´æ–°å¿ƒè·³æ—¶é—´
      const taskStore = useUnifiedTaskStore()
      taskStore.updateSSEHeartbeat()
    },

    connected: (data) => {
      // æ–°å¢ï¼šè¿æ¥æˆåŠŸæ—¶æ›´æ–°å¿ƒè·³
      const taskStore = useUnifiedTaskStore()
      taskStore.updateSSEHeartbeat()
      handlers.onConnected?.(data)
    }
  })
}
```

---

## 7. å®æ–½æ­¥éª¤

### é˜¶æ®µ 1ï¼šæ•°æ®å±‚é‡æ„ï¼ˆ1 å¤©ï¼‰

**ç›®æ ‡ï¼š** å»ºç«‹ç¨³å®šçš„æ•°æ®åŸºç¡€ï¼Œç¡®ä¿å•ä»»åŠ¡è¿è¡Œçº¦æŸ

**ä»»åŠ¡æ¸…å•ï¼š**
- [x] ä¿®æ”¹ `unifiedTaskStore.js`
  - [x] å°† `processingTasks` æ”¹ä¸º `processingTask`ï¼ˆå•ä¾‹ï¼‰
  - [x] æ·»åŠ  `queueOrder` ç´¢å¼•
  - [x] é‡æ„ `queuedTasks` è®¡ç®—å±æ€§ï¼ˆæŒ‰é¡ºåºæ’åºï¼‰
  - [x] æ·»åŠ  SSE å¿ƒè·³æ£€æµ‹æœºåˆ¶
  - [x] æ·»åŠ  `recentFinishedTasks`ï¼ˆé™åˆ¶ 20 æ¡ï¼‰
  - [x] å®ç° `updateSSEHeartbeat()` æ–¹æ³•
  - [x] æŒä¹…åŒ– `queueOrder`

**éªŒæ”¶æ ‡å‡†ï¼š**

```javascript
// æµ‹è¯•ä»£ç 
const store = useUnifiedTaskStore()

// 1. Processing ä»»åŠ¡åº”è¯¥æ˜¯å•ä¸ªå¯¹è±¡æˆ– null
console.assert(
  store.processingTask === null || typeof store.processingTask === 'object',
  'processingTask åº”è¯¥æ˜¯å•ä¸ªå¯¹è±¡æˆ– null'
)

// 2. queuedTasks åº”è¯¥æŒ‰ queueOrder æ’åº
const queuedIds = store.queuedTasks.map(t => t.job_id)
console.assert(
  JSON.stringify(queuedIds) === JSON.stringify(store.queueOrder),
  'queuedTasks é¡ºåºåº”è¯¥ä¸ queueOrder ä¸€è‡´'
)

// 3. å†å²è®°å½•åº”è¯¥é™åˆ¶æ•°é‡
console.assert(
  store.recentFinishedTasks.length <= 20,
  'å†å²è®°å½•åº”è¯¥æœ€å¤š 20 æ¡'
)
```

---

### é˜¶æ®µ 2ï¼šç»„ä»¶åŒ–ä¸å¸ƒå±€ï¼ˆ1 å¤©ï¼‰

**ç›®æ ‡ï¼š** å®ç°å›ºå®šå¤´éƒ¨ + å¯æ»šåŠ¨ä¸»ä½“çš„å¸ƒå±€ï¼Œå¼•å…¥æŠ˜å åŠŸèƒ½

**ä»»åŠ¡æ¸…å•ï¼š**

- [x] åˆ›å»º `TaskGroup.vue` ç»„ä»¶
  - [x] å®ç° CSS Grid æŠ˜å åŠ¨ç”»
  - [x] æ”¯æŒé»˜è®¤æŠ˜å /å±•å¼€
  - [x] æ”¯æŒè§†è§‰å˜ä½“ï¼ˆprimary/success/warning/dangerï¼‰
  - [x] ç‚¹å‡»æ ‡é¢˜æ åˆ‡æ¢æŠ˜å çŠ¶æ€

- [x] åˆ›å»º `TaskCard.vue` ç»„ä»¶
  - [x] ä» `TaskMonitor/index.vue` æå–ä»»åŠ¡å¡ç‰‡ UI
  - [x] æ”¯æŒæ‹–åŠ¨æ‰‹æŸ„ï¼ˆé€šè¿‡ `draggable` prop æ§åˆ¶ï¼‰
  - [x] å®ç°ä»»åŠ¡æ“ä½œæŒ‰é’®ï¼ˆæš‚åœ/æ¢å¤/å–æ¶ˆ/æ‰“å¼€ï¼‰

- [x] é‡æ„ `TaskMonitor/index.vue`
  - [x] å®ç°å›ºå®š Header + æ»šåŠ¨ Body å¸ƒå±€
  - [x] æ¸²æŸ“ Processing åŒºåŸŸï¼ˆå•ä¸ªä»»åŠ¡æˆ–ç©ºçŠ¶æ€ï¼‰
  - [x] ä½¿ç”¨ `TaskGroup` ç»„ä»¶æ¸²æŸ“ä»»åŠ¡åˆ†ç»„
  - [x] æ·»åŠ åº•éƒ¨æ¸å˜é®ç½©
  - [x] æ·»åŠ  SSE æ–­å¼€è­¦å‘Š

**éªŒæ”¶æ ‡å‡†ï¼š**

- [ ] Processing åŒºåŸŸå›ºå®šåœ¨é¡¶éƒ¨ï¼Œä¸éšä¸»ä½“æ»šåŠ¨
- [ ] ç‚¹å‡»åˆ†ç»„æ ‡é¢˜å¯ä»¥æŠ˜å /å±•å¼€
- [ ] æŠ˜å åŠ¨ç”»æµç•…ï¼ˆ300msï¼‰
- [ ] åº•éƒ¨æ¸å˜é®ç½©å§‹ç»ˆå¯è§
- [ ] SSE æ–­å¼€æ—¶æ˜¾ç¤ºè­¦å‘Šæ¨ªå¹…

---

### é˜¶æ®µ 3ï¼šæ‹–åŠ¨æ’åºé›†æˆï¼ˆ0.5 å¤©ï¼‰

**ç›®æ ‡ï¼š** æ¢å¤é˜Ÿåˆ—æ‹–åŠ¨æ’åºåŠŸèƒ½ï¼Œä¼˜åŒ–æ‰‹æ„Ÿ

**ä»»åŠ¡æ¸…å•ï¼š**

- [x] å®‰è£… `vuedraggable@next`
  ```bash
  npm install vuedraggable@next
  ```

- [x] åœ¨ `TaskMonitor/index.vue` ä¸­é›†æˆ `Draggable`
  - [x] ä»…åœ¨ Queued åˆ†ç»„å†…å¯ç”¨æ‹–åŠ¨
  - [x] é…ç½®æ»šåŠ¨çƒ­åŒºï¼ˆ`scrollSensitivity: 80`, `scrollSpeed: 20`ï¼‰
  - [x] ç»‘å®š `@end` äº‹ä»¶åˆ° `store.reorderQueue()`

- [x] ä¼˜åŒ–æ‹–åŠ¨æ ·å¼
  - [x] æ·»åŠ  `.task-ghost` å ä½ç¬¦æ ·å¼
  - [x] æ‹–åŠ¨æ‰‹æŸ„æ‚¬åœæ•ˆæœ
  - [x] æ‹–åŠ¨æ—¶æ”¹å˜å…‰æ ‡ï¼ˆ`cursor: grabbing`ï¼‰

**éªŒæ”¶æ ‡å‡†ï¼š**
- [ ] æ‹–åŠ¨ä»»åŠ¡å¡ç‰‡å¯ä»¥æ”¹å˜é˜Ÿåˆ—é¡ºåº
- [ ] æ‹–åŠ¨åˆ°è§†å£è¾¹ç¼˜æ—¶è‡ªåŠ¨æ»šåŠ¨
- [ ] å ä½ç¬¦æ¸…æ™°å¯è§ï¼ˆè™šçº¿è¾¹æ¡†ï¼‰
- [ ] æ‹–åŠ¨ç»“æŸåè°ƒç”¨åç«¯ API åŒæ­¥é¡ºåº
- [ ] API å¤±è´¥æ—¶æ¢å¤åŸé¡ºåº

---

### é˜¶æ®µ 4ï¼šSSE å¿ƒè·³ä¸ç»†èŠ‚ä¼˜åŒ–ï¼ˆ0.5 å¤©ï¼‰

**ç›®æ ‡ï¼š** å¢å¼º SSE ç¨³å®šæ€§ï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒ

**ä»»åŠ¡æ¸…å•ï¼š**
- [x] åœ¨ `sseChannelManager.js` ä¸­é›†æˆå¿ƒè·³å¤„ç†
  - [x] `ping` äº‹ä»¶è°ƒç”¨ `taskStore.updateSSEHeartbeat()`
  - [x] `connected` äº‹ä»¶è°ƒç”¨ `taskStore.updateSSEHeartbeat()`

- [x] åœ¨ `TaskMonitor/index.vue` ä¸­å¯åŠ¨å¿ƒè·³æ£€æµ‹å®šæ—¶å™¨
  ```javascript
  onMounted(() => {
    heartbeatTimer = setInterval(() => {
      taskStore.checkSSEConnection()
    }, 5000)  // æ¯ 5 ç§’æ£€æµ‹ä¸€æ¬¡
  })
  ```

- [x] æ·»åŠ ä»»åŠ¡å®Œæˆé«˜äº®åŠ¨ç”»
  - [x] åœ¨ `updateTask` ä¸­è®¾ç½® `isNewlyFinished = true`
  - [x] 2 ç§’åè‡ªåŠ¨ç§»é™¤æ ‡è®°
  - [x] ä½¿ç”¨ CSS `@keyframes highlight` å®ç°é—ªçƒæ•ˆæœ

- [x] ä¼˜åŒ–ç©ºçŠ¶æ€æ˜¾ç¤º
  - [x] Processing åŒºåŸŸæ— ä»»åŠ¡æ—¶æ˜¾ç¤ºæç¤º
  - [x] åˆ†ç»„å†…æ— ä»»åŠ¡æ—¶æ˜¾ç¤º"æš‚æ— ä»»åŠ¡"

**éªŒæ”¶æ ‡å‡†ï¼š**

- [ ] SSE æ–­å¼€ 30 ç§’åæ˜¾ç¤ºè­¦å‘Šæ¨ªå¹…
- [ ] SSE é‡è¿åè­¦å‘Šè‡ªåŠ¨æ¶ˆå¤±
- [ ] ä»»åŠ¡å®Œæˆæ—¶å¡ç‰‡çŸ­æš‚é«˜äº®ï¼ˆç»¿è‰²èƒŒæ™¯é—ªçƒï¼‰
- [ ] ç©ºçŠ¶æ€æ˜¾ç¤ºå‹å¥½æç¤ºä¿¡æ¯

---

### é˜¶æ®µ 5ï¼šé›†æˆæµ‹è¯•ä¸ä¿®å¤ï¼ˆ0.5 å¤©ï¼‰

**ç›®æ ‡ï¼š** ç«¯åˆ°ç«¯æµ‹è¯•ï¼Œä¿®å¤è¾¹ç•Œæƒ…å†µ

**æµ‹è¯•ç”¨ä¾‹ï¼š**
1. **å•ä»»åŠ¡è¿è¡ŒéªŒè¯**
   - [ ] Processing åŒºåŸŸæœ€å¤šæ˜¾ç¤º 1 ä¸ªä»»åŠ¡
   - [ ] ä»»åŠ¡å®Œæˆåï¼Œä¸‹ä¸€ä¸ªæ’é˜Ÿä»»åŠ¡è‡ªåŠ¨å¼€å§‹

2. **æ‹–åŠ¨æ’åº**
   - [ ] æ‹–åŠ¨ä»»åŠ¡æ”¹å˜é˜Ÿåˆ—é¡ºåº
   - [ ] åç«¯ API å¤±è´¥æ—¶æ¢å¤åŸé¡ºåº
   - [ ] æ‹–åŠ¨æœŸé—´ SSE æ›´æ–°ä¸å¹²æ‰°é¡ºåº

3. **æŠ˜å åŠŸèƒ½**
   - [ ] ç‚¹å‡»æ ‡é¢˜æ åˆ‡æ¢æŠ˜å 
   - [ ] åˆ·æ–°é¡µé¢åä¿æŒæŠ˜å çŠ¶æ€ï¼ˆå¯é€‰ï¼‰
   - [ ] æŠ˜å åŠ¨ç”»æµç•…ï¼Œæ— å¡é¡¿

4. **SSE ç¨³å®šæ€§**
   - [ ] æ–­å¼€ç½‘ç»œ 30 ç§’åæ˜¾ç¤ºè­¦å‘Š
   - [ ] æ¢å¤ç½‘ç»œåè‡ªåŠ¨é‡è¿
   - [ ] å¿ƒè·³æ­£å¸¸æ—¶ `sseConnected` ä¸º `true`

5. **å†å²è®°å½•é™åˆ¶**
   - [ ] å®Œæˆ 30 ä¸ªä»»åŠ¡åï¼Œåªæ˜¾ç¤ºæœ€è¿‘ 20 ä¸ª
   - [ ] "æŸ¥çœ‹æ›´å¤š"æŒ‰é’®è·³è½¬åˆ°å†å²é¡µé¢

---

## 8. éªŒæ”¶æ ‡å‡†

### 8.1 åŠŸèƒ½éªŒæ”¶

| åŠŸèƒ½ç‚¹ | éªŒæ”¶æ ‡å‡† | ä¼˜å…ˆçº§ |
|--------|---------|--------|
| å•ä»»åŠ¡è¿è¡Œ | Processing åŒºåŸŸæœ€å¤šæ˜¾ç¤º 1 ä¸ªä»»åŠ¡ | P0 |
| ä»»åŠ¡åˆ†ç»„ | æŒ‰çŠ¶æ€åˆ†ä¸º Failed/Queued/Paused/Finished 4 ç»„ | P0 |
| æŠ˜å åŠŸèƒ½ | ç‚¹å‡»æ ‡é¢˜æ å¯åˆ‡æ¢æŠ˜å /å±•å¼€ | P0 |
| æ‹–åŠ¨æ’åº | Queued ä»»åŠ¡å¯æ‹–åŠ¨æ”¹å˜é¡ºåº | P0 |
| å†å²é™åˆ¶ | Finished åˆ†ç»„æœ€å¤šæ˜¾ç¤º 20 æ¡ | P1 |
| SSE æ£€æµ‹ | æ–­å¼€ 30 ç§’åæ˜¾ç¤ºè­¦å‘Š | P1 |
| ä»»åŠ¡é«˜äº® | å®Œæˆæ—¶çŸ­æš‚é«˜äº®ï¼ˆ2 ç§’ï¼‰ | P2 |
| åº•éƒ¨é®ç½© | å§‹ç»ˆæ˜¾ç¤ºæ¸å˜é®ç½© | P2 |

### 8.2 æ€§èƒ½éªŒæ”¶

| æŒ‡æ ‡ | æ ‡å‡† | æµ‹è¯•æ–¹æ³• |
|------|------|---------|
| æŠ˜å åŠ¨ç”» | < 300ms | Chrome DevTools Performance |
| æ‹–åŠ¨å“åº” | < 100ms | æ‰‹åŠ¨æµ‹è¯•ï¼Œæ— æ˜æ˜¾å»¶è¿Ÿ |
| åˆ—è¡¨æ¸²æŸ“ | 50 ä¸ªä»»åŠ¡ < 500ms | æ¨¡æ‹Ÿ 50 ä¸ªä»»åŠ¡ï¼Œæµ‹è¯•é¦–å±æ¸²æŸ“ |
| SSE å¿ƒè·³ | æ¯ 30s æ£€æµ‹ä¸€æ¬¡ | æ–­å¼€ç½‘ç»œï¼Œè§‚å¯Ÿè­¦å‘Šå‡ºç°æ—¶é—´ |

### 8.3 å…¼å®¹æ€§éªŒæ”¶

| æµè§ˆå™¨ | ç‰ˆæœ¬ | éªŒæ”¶ç»“æœ |
|--------|------|---------|
| Chrome | >= 90 | âœ… |
| Edge | >= 90 | âœ… |
| Firefox | >= 88 | âœ… |
| Safari | >= 14 | âš ï¸ CSS Grid åŠ¨ç”»å¯èƒ½æœ‰å·®å¼‚ |

---

## 9. é£é™©ä¸åº”å¯¹

### 9.1 æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | åº”å¯¹æªæ–½ |
|------|------|------|---------|
| CSS Grid æŠ˜å åœ¨æ—§æµè§ˆå™¨ä¸å…¼å®¹ | ä¸­ | ä½ | ä½¿ç”¨ `max-height` Fallback |
| æ‹–åŠ¨ä¸ SSE æ›´æ–°å†²çª | é«˜ | ä¸­ | æ‹–åŠ¨æœŸé—´æš‚åœ SSE æ›´æ–° |
| å†å²è®°å½•è¿‡å¤šå¯¼è‡´å¡é¡¿ | ä¸­ | ä½ | é™åˆ¶æ˜¾ç¤ºæ•°é‡ï¼ˆå·²å®ç°ï¼‰ |
| SSE å¿ƒè·³æ£€æµ‹è¯¯æŠ¥ | ä½ | ä¸­ | å»¶é•¿è¶…æ—¶æ—¶é—´è‡³ 60 ç§’ |

### 9.2 è¿ç§»é£é™©

| é£é™© | å½±å“ | åº”å¯¹æªæ–½ |
|------|------|---------|
| ç°æœ‰ç”¨æˆ·ä¹ æƒ¯æ”¹å˜ | ä¸­ | ä¿æŒæ ¸å¿ƒæ“ä½œä¸€è‡´ï¼Œæ·»åŠ å¼•å¯¼æç¤º |
| localStorage æ•°æ®æ ¼å¼å˜æ›´ | é«˜ | å®ç°æ•°æ®è¿ç§»è„šæœ¬ |
| æ—§ç‰ˆç»„ä»¶ä¾èµ– | ä½ | ä¿ç•™æ—§ç‰ˆç»„ä»¶ï¼Œé€æ­¥åºŸå¼ƒ |

---

## 10. åç»­ä¼˜åŒ–æ–¹å‘

1. **è™šæ‹Ÿæ»šåŠ¨**ï¼ˆå¦‚æœå†å²è®°å½•éœ€è¦æ˜¾ç¤º 100+ æ¡ï¼‰
   - å¼•å…¥ `vue-virtual-scroller`
   - ä»…åœ¨ç‹¬ç«‹çš„å†å²è®°å½•é¡µé¢ä½¿ç”¨

2. **ä»»åŠ¡åˆ†ç»„æŠ˜å çŠ¶æ€æŒä¹…åŒ–**
   - å°†æŠ˜å çŠ¶æ€ä¿å­˜åˆ° localStorage
   - åˆ·æ–°é¡µé¢åä¿æŒçŠ¶æ€

3. **é«˜çº§è¿‡æ»¤ä¸æœç´¢**
   - æŒ‰æ–‡ä»¶åæœç´¢ä»»åŠ¡
   - æŒ‰æ—¶é—´èŒƒå›´ç­›é€‰
   - æŒ‰çŠ¶æ€å¿«é€Ÿè¿‡æ»¤

4. **ä»»åŠ¡ç»Ÿè®¡é¢æ¿**
   - æ˜¾ç¤ºæˆåŠŸç‡ã€å¹³å‡å¤„ç†æ—¶é—´
   - æ˜¾ç¤ºé˜Ÿåˆ—ç­‰å¾…æ—¶é—´é¢„ä¼°

5. **æ‹–åŠ¨ä¼˜åŒ–**
   - æ”¯æŒå¤šé€‰ä»»åŠ¡æ‰¹é‡æ’åº
   - æ”¯æŒé”®ç›˜å¿«æ·é”®ï¼ˆCtrl+â†‘/â†“ï¼‰

---

## 11. é™„å½•

### 11.1 ç›¸å…³æ–‡æ¡£

- [ä»»åŠ¡ç›‘æ§å™¨ UI ç³»ç»Ÿè®¾è®¡æ–‡æ¡£.md](./ä»»åŠ¡ç›‘æ§å™¨%20UI%20ç³»ç»Ÿè®¾è®¡æ–‡æ¡£.md)
- [ä»»åŠ¡ç›‘è§†2.md](./ä»»åŠ¡ç›‘è§†2.md)
- [UnifiedTaskStore.md](./ç»„ä»¶/UnifiedTaskStore.md)

### 11.2 ä¾èµ–åº“

```json
{
  "dependencies": {
    "vue": "^3.3.0",
    "pinia": "^2.1.0",
    "vue-router": "^4.2.0",
    "vuedraggable": "^4.1.0"
  }
}
```

### 11.3 CSS å˜é‡

```css
:root {
  /* é¢œè‰² */
  --primary: #58a6ff;
  --success: #3fb950;
  --warning: #d29922;
  --danger: #f85149;

  /* èƒŒæ™¯ */
  --bg-primary: #ffffff;
  --bg-secondary: #f6f8fa;
  --bg-tertiary: #f0f0f0;
  --bg-elevated: #ffffff;

  /* è¾¹æ¡† */
  --border-default: #d0d7de;
  --border-muted: #e5e5e5;

  /* æ–‡å­— */
  --text-primary: #24292f;
  --text-secondary: #57606a;
  --text-muted: #8b949e;

  /* é˜´å½± */
  --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
}
```

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0
**æœ€åæ›´æ–°ï¼š** 2025-01-XX
**ç»´æŠ¤è€…ï¼š** å¼€å‘å›¢é˜Ÿ
