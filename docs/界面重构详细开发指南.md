# Video-to-SRT Proï¼šå‰ç«¯é‡æ„è¯¦ç»†å¼€å‘æŒ‡å— (v3.0)

> é’ˆå¯¹ç‹¬ç«‹å¼€å‘è€…çš„å®æˆ˜å¼€å‘æ–‡æ¡£ - ä»å½“å‰çŠ¶æ€åˆ°ä¸“ä¸šå­—å¹•ç¼–è¾‘å™¨

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®ç°çŠ¶åˆ†æ](#1-é¡¹ç›®ç°çŠ¶åˆ†æ)
2. [é‡æ„ç›®æ ‡ä¸æŠ€æœ¯é€‰å‹](#2-é‡æ„ç›®æ ‡ä¸æŠ€æœ¯é€‰å‹)
3. [æ ¸å¿ƒæ•°æ®æ¶æ„è®¾è®¡](#3-æ ¸å¿ƒæ•°æ®æ¶æ„è®¾è®¡)
4. [è¯¦ç»†å¼€å‘é˜¶æ®µè§„åˆ’](#4-è¯¦ç»†å¼€å‘é˜¶æ®µè§„åˆ’)
5. [æŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ](#5-æŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ)
6. [æ–‡ä»¶ç»“æ„ä¸ç»„ç»‡](#6-æ–‡ä»¶ç»“æ„ä¸ç»„ç»‡)
7. [è´¨é‡ä¿éšœç­–ç•¥](#7-è´¨é‡ä¿éšœç­–ç•¥)

---

## 1. é¡¹ç›®ç°çŠ¶åˆ†æ

### 1.1 å½“å‰æŠ€æœ¯æ ˆ

**å‰ç«¯ï¼š**
- âœ… Vue 3.4 + Composition API
- âœ… Vite 5.2ï¼ˆå¿«é€Ÿæ„å»ºï¼‰
- âœ… Pinia 3.0ï¼ˆå·²æœ‰ modelStore çŠ¶æ€ç®¡ç†ï¼‰
- âœ… Element Plus 2.11ï¼ˆUIæ¡†æ¶ï¼‰
- âœ… Axiosï¼ˆHTTPè¯·æ±‚ï¼‰

**åç«¯ï¼š**
- âœ… FastAPI 0.3.0ï¼ˆPython Webæ¡†æ¶ï¼‰
- âœ… WhisperXï¼ˆAIè½¬å½•æ ¸å¿ƒï¼‰
- âœ… å®Œå–„çš„æ¨¡å‹ç®¡ç†ç³»ç»Ÿï¼ˆä¸‹è½½ã€éªŒè¯ã€é¢„åŠ è½½ã€SSEæ¨é€ï¼‰
- âœ… ç¡¬ä»¶æ£€æµ‹å’Œä¼˜åŒ–ç³»ç»Ÿ

### 1.2 å·²æœ‰åŠŸèƒ½ç‰¹æ€§

**è½¬å½•æµç¨‹ï¼ˆå®Œå–„ï¼‰ï¼š**

1. æ–‡ä»¶é€‰æ‹©/ä¸Šä¼ ï¼ˆæ”¯æŒæœ¬åœ°é€‰æ‹©å’Œæ‹–æ‹½ä¸Šä¼ ï¼‰
2. å‚æ•°é…ç½®ï¼ˆæ¨¡å‹ã€è®¾å¤‡ã€æ‰¹é‡å¤§å°ã€CPUäº²å’Œæ€§ï¼‰
3. è½¬å½•å¤„ç†ï¼ˆéŸ³é¢‘æå–ã€æ™ºèƒ½åˆ†æ®µã€è¯­éŸ³è¯†åˆ«ã€å¯¹é½ï¼‰
4. è¿›åº¦è·Ÿè¸ªï¼ˆå®æ—¶è¿›åº¦æ¡ã€é˜¶æ®µæç¤ºã€é”™è¯¯æ•è·ï¼‰
5. ç»“æœä¸‹è½½ï¼ˆSRTæ–‡ä»¶å¯¼å‡ºï¼‰

**æ¨¡å‹ç®¡ç†ï¼ˆå®Œå–„ï¼‰ï¼š**
1. æ¨¡å‹ä¸‹è½½ç®¡ç†ï¼ˆWhisperæ¨¡å‹ã€å¯¹é½æ¨¡å‹ï¼‰
2. SSEå®æ—¶è¿›åº¦æ¨é€
3. æ¨¡å‹é¢„åŠ è½½å’Œç¼“å­˜ï¼ˆLRUç¼“å­˜ç­–ç•¥ï¼‰
4. æ¨¡å‹å®Œæ•´æ€§éªŒè¯

**çŠ¶æ€ç®¡ç†ï¼ˆå·²å»ºç«‹ï¼‰ï¼š**
- `modelStore.js`ï¼šç®¡ç†æ¨¡å‹çŠ¶æ€å’ŒSSEè¿æ¥

### 1.3 å¾…é‡æ„éƒ¨åˆ†ï¼ˆæœ¬æ–‡æ¡£æ ¸å¿ƒï¼‰

**å½“å‰ç¼ºå¤±çš„æ ¸å¿ƒåŠŸèƒ½ï¼š**
1. âŒ **å­—å¹•ç¼–è¾‘ç•Œé¢**ï¼ˆæ ¸å¿ƒé‡æ„ç›®æ ‡ï¼‰
2. âŒ **è§†é¢‘æ’­æ”¾å™¨é›†æˆ**
3. âŒ **æ³¢å½¢æ—¶é—´è½´å¯è§†åŒ–**
4. âŒ **å­—å¹•ä¸è§†é¢‘çš„ç²¾ç¡®åŒæ­¥**
5. âŒ **å­—å¹•æ‹–æ‹½è°ƒæ•´æ—¶é—´**
6. âŒ **å­—å¹•æ–‡æœ¬å®æ—¶ç¼–è¾‘**

**ç°çŠ¶æ€»ç»“ï¼š**
- âœ… **è½¬å½•ç³»ç»Ÿ**å·²å®Œå–„ï¼ˆè¾“å…¥ â†’ å¤„ç† â†’ è¾“å‡ºï¼‰
- âŒ **ç¼–è¾‘ç³»ç»Ÿ**å°šæœªå»ºç«‹ï¼ˆå¯¼å…¥ â†’ ç¼–è¾‘ â†’ å¯¼å‡ºï¼‰

---

## 2. é‡æ„ç›®æ ‡ä¸æŠ€æœ¯é€‰å‹

### 2.1 äº§å“æ„¿æ™¯

**ä»"è½¬å½•å·¥å…·"å‡çº§ä¸º"å­—å¹•ç¼–è¾‘å·¥ä½œå°"ï¼š**

```
[æ—§] ä¸Šä¼ è§†é¢‘ â†’ è½¬å½• â†’ ä¸‹è½½SRT â†’ å¤–éƒ¨å·¥å…·ç¼–è¾‘

[æ–°] ä¸Šä¼ è§†é¢‘ â†’ è½¬å½• â†’ åœ¨çº¿ç¼–è¾‘ â†’ å¯¼å‡ºSRT/çƒ§å½•è§†é¢‘
```

**æ ¸å¿ƒä»·å€¼ï¼š**

1. **Local-First**ï¼šæœ¬åœ°å¤„ç†ï¼Œéšç§å®‰å…¨
2. **éçº¿æ€§ç¼–è¾‘**ï¼šç²¾ç¡®åˆ°å¸§çš„æ—¶é—´è½´æ“ä½œ
3. **ç”Ÿäº§åŠ›å·¥å…·**ï¼šå‡å°‘å·¥ä½œæµåˆ‡æ¢ï¼Œæå‡æ•ˆç‡

### 2.2 æŠ€æœ¯é€‰å‹å†³ç­–

#### 2.2.1 æ–°å¢æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç”¨é€” | é€‰æ‹©ç†ç”± |
|------|------|----------|
| **wavesurfer.js V7** | éŸ³è§†é¢‘æ³¢å½¢å¯è§†åŒ– | æˆç†Ÿç¨³å®šã€æ’ä»¶ä¸°å¯Œã€æ”¯æŒåç«¯å³°å€¼æ•°æ® |
| **SCSS** | æ ·å¼é¢„å¤„ç†å™¨ | æ¨¡å—åŒ–ã€å˜é‡ã€æ··åˆå®ï¼Œä¾¿äºä¸»é¢˜åˆ‡æ¢ |
| **@vueuse/core** | Vueç»„åˆå¼å·¥å…·åº“ | æä¾› useDarkã€useResizeObserverã€useRefHistory ç­‰ |
| **vue-virtual-scroller** | è™šæ‹Ÿæ»šåŠ¨ | ä¼˜åŒ–é•¿åˆ—è¡¨æ€§èƒ½ï¼ˆåƒæ¡å­—å¹•ï¼‰ |
| **localforage** | IndexedDBå°è£…åº“ | æ›¿ä»£localStorageï¼Œæ”¯æŒå¤§æ•°æ®é‡å¼‚æ­¥å­˜å‚¨ |

#### 2.2.2 æŠ€æœ¯ä¸é€‰æ¸…å•

| æŠ€æœ¯ | ä¸ºä½•ä¸é€‰ |
|------|----------|
| Electron | å·²æ˜¯Webåº”ç”¨ï¼Œæ— éœ€æ¡Œé¢åŒ– |
| TypeScript | å¢åŠ å­¦ä¹ æˆæœ¬ï¼Œå¯¹ç‹¬ç«‹å¼€å‘è€…ä¸å‹å¥½ |
| TailwindCSS | ä¸Element Pluså†²çªï¼Œæ ·å¼ç®¡ç†æ··ä¹± |
| Redux/Vuex | Piniaå·²è¶³å¤Ÿï¼Œé¿å…è¿‡åº¦å·¥ç¨‹ |

### 2.3 äº§å“åŠŸèƒ½è§„åˆ’

#### æ ¸å¿ƒåŠŸèƒ½ï¼ˆMVPï¼‰

1. âœ… **è§†é¢‘æ’­æ”¾å™¨**ï¼šæ’­æ”¾/æš‚åœã€è¿›åº¦æ‹–æ‹½ã€å€é€Ÿæ§åˆ¶
2. âœ… **æ³¢å½¢æ—¶é—´è½´**ï¼šå¯è§†åŒ–éŸ³é¢‘ã€æ‹–æ‹½è°ƒæ•´æ—¶é—´
3. âœ… **å­—å¹•åˆ—è¡¨**ï¼šæ»šåŠ¨åˆ—è¡¨ã€ç‚¹å‡»è·³è½¬ã€ç¼–è¾‘æ–‡æœ¬
4. âœ… **åŒå‘åŒæ­¥**ï¼šæ³¢å½¢æ‹–æ‹½ â†”ï¸ åˆ—è¡¨æ›´æ–° â†”ï¸ æ’­æ”¾å™¨è·³è½¬

#### æ‰©å±•åŠŸèƒ½ï¼ˆäºŒæœŸï¼‰

1. ğŸ”² å­—å¹•ç¿»è¯‘ï¼ˆAPIé›†æˆï¼‰
2. ğŸ”² è¯´è¯äººåˆ†ç¦»ï¼ˆpyannoteé›†æˆï¼‰
3. ğŸ”² è§†é¢‘å‹åˆ¶ï¼ˆFFmpegçƒ§å½•å­—å¹•ï¼‰
4. ğŸ”² æ‰¹é‡æ“ä½œï¼ˆåˆå¹¶ã€åˆ†å‰²ã€æ—¶é—´åç§»ï¼‰

---

## 3. æ ¸å¿ƒæ•°æ®æ¶æ„è®¾è®¡

### 3.1 Pinia Store è®¾è®¡ï¼ˆprojectStore.jsï¼‰

```javascript
// stores/projectStore.js
import { defineStore } from 'pinia'
import { ref, computed, watch } from 'vue'
import { useRefHistory } from '@vueuse/core'
import localforage from 'localforage'

export const useProjectStore = defineStore('project', () => {
  // ========== 1. é¡¹ç›®å…ƒæ•°æ® ==========
  const meta = ref({
    jobId: null,              // è½¬å½•ä»»åŠ¡ID
    videoPath: null,          // è§†é¢‘æ–‡ä»¶è·¯å¾„ï¼ˆç”¨äº <video>ï¼‰
    audioPath: null,          // éŸ³é¢‘æ–‡ä»¶è·¯å¾„ï¼ˆç”¨äº wavesurferï¼‰
    peaksPath: null,          // æ³¢å½¢å³°å€¼æ•°æ®è·¯å¾„ï¼ˆåç«¯é¢„è®¡ç®—ï¼‰
    duration: 0,              // è§†é¢‘æ€»æ—¶é•¿ï¼ˆç§’ï¼‰
    filename: '',             // æºæ–‡ä»¶å
    videoFormat: null,        // è§†é¢‘æ ¼å¼ï¼ˆç”¨äºæ£€æµ‹æµè§ˆå™¨å…¼å®¹æ€§ï¼‰
    hasProxyVideo: false,     // æ˜¯å¦æœ‰ Proxy è§†é¢‘
    lastSaved: Date.now(),    // æœ€åä¿å­˜æ—¶é—´
    isDirty: false            // æ˜¯å¦æœ‰æœªä¿å­˜ä¿®æ”¹
  })

  // ========== 2. å­—å¹•æ•°æ®ï¼ˆSingle Source of Truthï¼‰ ==========
  const subtitles = ref([
    // {
    //   id: "uuid-1",
    //   start: 1.500,      // ç§’ï¼ˆfloatï¼Œ3ä½å°æ•°ï¼‰
    //   end: 3.200,
    //   text: "Hello World",
    //   isDirty: false     // å•è¡Œè„æ ‡è®°
    // }
  ])

  // ========== 3. Undo/Redo å†å²è®°å½• ==========
  const {
    history,
    undo,
    redo,
    canUndo,
    canRedo,
    clear: clearHistory
  } = useRefHistory(subtitles, {
    deep: true,
    capacity: 50,  // é™åˆ¶å†å²è®°å½•æ­¥æ•°ï¼Œé¿å…å†…å­˜æº¢å‡º
    clone: true    // æ·±æ‹·è´ï¼Œç¡®ä¿å†å²è®°å½•ç‹¬ç«‹
  })

  // ========== 4. æ’­æ”¾å™¨å…¨å±€çŠ¶æ€ ==========
  const player = ref({
    currentTime: 0,          // å½“å‰æ’­æ”¾æ—¶é—´ï¼ˆç§’ï¼‰
    isPlaying: false,        // æ˜¯å¦æ­£åœ¨æ’­æ”¾
    playbackRate: 1.0,       // æ’­æ”¾é€Ÿåº¦ï¼ˆ0.5-4.0ï¼‰
    volume: 1.0              // éŸ³é‡ï¼ˆ0.0-1.0ï¼‰
  })

  // ========== 5. è§†å›¾çŠ¶æ€ ==========
  const view = ref({
    theme: 'dark',           // 'dark' | 'light'
    zoomLevel: 100,          // æ³¢å½¢ç¼©æ”¾æ¯”ä¾‹ï¼ˆ%ï¼‰
    autoScroll: true,        // åˆ—è¡¨è‡ªåŠ¨è·Ÿéšæ’­æ”¾
    selectedSubtitleId: null // å½“å‰é€‰ä¸­çš„å­—å¹•ID
  })

  // ========== 6. è®¡ç®—å±æ€§ ==========
  const totalSubtitles = computed(() => subtitles.value.length)

  const currentSubtitle = computed(() => {
    return subtitles.value.find(s =>
      player.value.currentTime >= s.start &&
      player.value.currentTime < s.end
    )
  })

  const isDirty = computed(() => {
    return meta.value.isDirty || subtitles.value.some(s => s.isDirty)
  })

  // ========== 7. è‡ªåŠ¨ä¿å­˜åˆ° IndexedDB ==========
  watch([subtitles, meta], async () => {
    if (meta.value.jobId) {
      try {
        await localforage.setItem(`project-${meta.value.jobId}`, {
          subtitles: subtitles.value,
          meta: meta.value,
          savedAt: Date.now()
        })
        console.log('âœ… é¡¹ç›®è‡ªåŠ¨ä¿å­˜æˆåŠŸ')
      } catch (error) {
        console.error('âŒ è‡ªåŠ¨ä¿å­˜å¤±è´¥:', error)
      }
    }
  }, {
    deep: true,
    throttle: 3000  // 3ç§’èŠ‚æµï¼Œé¿å…é¢‘ç¹å†™å…¥
  })

  // ========== 8. Actions ==========

  /**
   * å¯¼å…¥SRTå­—å¹•ï¼ˆä»è½¬å½•ç»“æœåŠ è½½ï¼‰
   */
  function importSRT(srtContent, metadata) {
    const parsed = parseSRT(srtContent)
    subtitles.value = parsed.map((item, idx) => ({
      id: `subtitle-${Date.now()}-${idx}`,
      start: item.start,
      end: item.end,
      text: item.text,
      isDirty: false
    }))

    meta.value = {
      ...meta.value,
      ...metadata,
      lastSaved: Date.now(),
      isDirty: false
    }

    // æ¸…é™¤å†å²è®°å½•ï¼Œé¿å…æ’¤é”€åˆ°ç©ºçŠ¶æ€
    clearHistory()
  }

  /**
   * ä» IndexedDB æ¢å¤é¡¹ç›®
   */
  async function restoreProject(jobId) {
    try {
      const saved = await localforage.getItem(`project-${jobId}`)
      if (saved) {
        subtitles.value = saved.subtitles
        meta.value = saved.meta
        console.log('âœ… é¡¹ç›®å·²ä»ç¼“å­˜æ¢å¤')
        return true
      }
      return false
    } catch (error) {
      console.error('âŒ æ¢å¤é¡¹ç›®å¤±è´¥:', error)
      return false
    }
  }

  /**
   * æ›´æ–°å­—å¹•å†…å®¹
   */
  function updateSubtitle(id, payload) {
    const index = subtitles.value.findIndex(s => s.id === id)
    if (index === -1) return

    subtitles.value[index] = {
      ...subtitles.value[index],
      ...payload,
      isDirty: true
    }
    meta.value.isDirty = true
  }

  /**
   * æ·»åŠ å­—å¹•
   */
  function addSubtitle(insertIndex, payload) {
    const newSubtitle = {
      id: `subtitle-${Date.now()}`,
      start: payload.start || 0,
      end: payload.end || 0,
      text: payload.text || '',
      isDirty: true
    }
    subtitles.value.splice(insertIndex, 0, newSubtitle)
    meta.value.isDirty = true
  }

  /**
   * åˆ é™¤å­—å¹•
   */
  function removeSubtitle(id) {
    const index = subtitles.value.findIndex(s => s.id === id)
    if (index !== -1) {
      subtitles.value.splice(index, 1)
      meta.value.isDirty = true
    }
  }

  /**
   * å¯¼å‡ºSRTå­—ç¬¦ä¸²
   */
  function generateSRT() {
    let srtContent = ''
    subtitles.value.forEach((sub, index) => {
      srtContent += `${index + 1}\n`
      srtContent += `${formatTimestamp(sub.start)} --> ${formatTimestamp(sub.end)}\n`
      srtContent += `${sub.text}\n\n`
    })
    return srtContent
  }

  /**
   * åŒæ­¥æ’­æ”¾å™¨æ—¶é—´
   */
  function seekTo(time) {
    player.value.currentTime = time
  }

  /**
   * ä¿å­˜é¡¹ç›®ï¼ˆæŒä¹…åŒ–åˆ°åç«¯ï¼‰
   */
  async function saveProject() {
    // TODO: è°ƒç”¨åç«¯APIä¿å­˜ç¼–è¾‘åçš„å­—å¹•
    const srtContent = generateSRT()
    // await api.saveSubtitle(meta.value.jobId, srtContent)

    meta.value.lastSaved = Date.now()
    meta.value.isDirty = false
    subtitles.value.forEach(s => s.isDirty = false)
  }

  // ========== 9. è¾…åŠ©å‡½æ•° ==========
  function parseSRT(srtContent) {
    // ç®€åŒ–ç‰ˆSRTè§£æï¼ˆå®é™…éœ€æ›´å¥å£®ï¼‰
    const blocks = srtContent.trim().split(/\n\n+/)
    return blocks.map(block => {
      const lines = block.split('\n')
      const timeMatch = lines[1]?.match(/(\d{2}:\d{2}:\d{2},\d{3}) --> (\d{2}:\d{2}:\d{2},\d{3})/)
      if (!timeMatch) return null

      return {
        start: parseTimestamp(timeMatch[1]),
        end: parseTimestamp(timeMatch[2]),
        text: lines.slice(2).join('\n')
      }
    }).filter(Boolean)
  }

  function parseTimestamp(ts) {
    // "00:01:23,456" => 83.456 ç§’
    const [h, m, s] = ts.replace(',', '.').split(':')
    return parseInt(h) * 3600 + parseInt(m) * 60 + parseFloat(s)
  }

  function formatTimestamp(sec) {
    // 83.456 => "00:01:23,456"
    const h = Math.floor(sec / 3600)
    const m = Math.floor((sec % 3600) / 60)
    const s = Math.floor(sec % 60)
    const ms = Math.round((sec % 1) * 1000)
    return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')},${ms.toString().padStart(3, '0')}`
  }

  return {
    // çŠ¶æ€
    meta,
    subtitles,
    player,
    view,

    // è®¡ç®—å±æ€§
    totalSubtitles,
    currentSubtitle,
    isDirty,

    // å†å²è®°å½•
    canUndo,
    canRedo,
    undo,
    redo,

    // æ“ä½œæ–¹æ³•
    importSRT,
    restoreProject,
    updateSubtitle,
    addSubtitle,
    removeSubtitle,
    generateSRT,
    seekTo,
    saveProject
  }
})
```

### 3.2 æ•°æ®æµè®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Pinia Store                        â”‚
â”‚  (Single Source of Truth)                           â”‚
â”‚                                                      â”‚
â”‚  subtitles: [{ id, start, end, text }]              â”‚
â”‚  player: { currentTime, isPlaying, ... }            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                    â”‚
       â†“                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WaveformView â”‚ â† Regionæ‹–æ‹½ â†’    â”‚ SubtitleList     â”‚
â”‚              â”‚                   â”‚                  â”‚
â”‚ wavesurfer   â”‚ â† ç‚¹å‡»è·³è½¬ â†’      â”‚ è™šæ‹Ÿæ»šåŠ¨åˆ—è¡¨     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                    â”‚
       â†“                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              VideoPlayer (HTML5 <video>)             â”‚
â”‚  currentTime â† â†’ Store.player.currentTime            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®åŒæ­¥é€»è¾‘ï¼š**
1. **æ³¢å½¢Regionæ‹–æ‹½** â†’ `updateSubtitle(id, { start, end })` â†’ è§¦å‘åˆ—è¡¨UIæ›´æ–°
2. **åˆ—è¡¨æ—¶é—´è¾“å…¥** â†’ `updateSubtitle(id, { start, end })` â†’ è§¦å‘æ³¢å½¢Regioné‡ç»˜
3. **ç‚¹å‡»å­—å¹•** â†’ `seekTo(time)` â†’ è§†é¢‘è·³è½¬ + æ³¢å½¢å±…ä¸­
4. **æ’­æ”¾å™¨æ—¶é—´å˜åŒ–** â†’ `player.currentTime` â†’ é«˜äº®å½“å‰å­—å¹• + è‡ªåŠ¨æ»šåŠ¨

---

## 4. è¯¦ç»†å¼€å‘é˜¶æ®µè§„åˆ’

> **ç‹¬ç«‹å¼€å‘è€…ä¼˜åŒ–åŸåˆ™ï¼š**
> 1. æ¯ä¸ªé˜¶æ®µäº§å‡ºå¯æ¼”ç¤ºçš„åŠŸèƒ½å¢é‡
> 2. é¿å…è¿‡æ—©ä¼˜åŒ–ï¼Œå…ˆå®ç°æ ¸å¿ƒæµç¨‹
> 3. ä¿æŒåç«¯APIå…¼å®¹æ€§ï¼Œä¸ç ´åç°æœ‰è½¬å½•åŠŸèƒ½

---

### é˜¶æ®µ 0ï¼šç¯å¢ƒå‡†å¤‡ï¼ˆé¢„è®¡1å¤©ï¼‰

#### ä»»åŠ¡æ¸…å•

- [ ] **å®‰è£…æ–°å¢ä¾èµ–**
  ```bash
  cd frontend
  npm install wavesurfer.js@7 @vueuse/core vue-virtual-scroller sass localforage
  ```

  **ä¾èµ–è¯´æ˜ï¼š**
  - `localforage`: IndexedDBå°è£…åº“ï¼Œæ›¿ä»£localStorageå®ç°å¤§æ•°æ®é‡å¼‚æ­¥å­˜å‚¨
  - `@vueuse/core`: åŒ…å« useRefHistory ç”¨äºå®ç°æ’¤é”€/é‡åšåŠŸèƒ½

- [ ] **é…ç½®SCSSæ”¯æŒ**
  ```javascript
  // vite.config.js
  export default {
    css: {
      preprocessorOptions: {
        scss: {
          additionalData: `@import "@/assets/styles/_variables.scss";`
        }
      }
    }
  }
  ```

- [ ] **åˆ›å»ºæ ·å¼å˜é‡æ–‡ä»¶**
  ```scss
  // frontend/src/assets/styles/_variables.scss
  // é¢œè‰²ç³»ç»Ÿï¼ˆæ·±è‰²æ¨¡å¼ä¼˜å…ˆï¼‰
  $bg-primary: #1e1e1e;
  $bg-secondary: #2d2d2d;
  $text-normal: #cccccc;
  $text-muted: #888888;
  $accent-blue: #409eff;
  $border-color: rgba(255, 255, 255, 0.1);
  
  // æµ…è‰²æ¨¡å¼è¦†ç›–ï¼ˆé€šè¿‡ CSS Variables åˆ‡æ¢ï¼‰
  :root {
    --bg-primary: #{$bg-primary};
    --bg-secondary: #{$bg-secondary};
    --text-normal: #{$text-normal};
    --text-muted: #{$text-muted};
  }
  
  [data-theme="light"] {
    --bg-primary: #ffffff;
    --bg-secondary: #f5f5f5;
    --text-normal: #333333;
    --text-muted: #666666;
  }
  ```

- [ ] **åˆ›å»ºå“åº”å¼æ–­ç‚¹æ··åˆå®**
  ```scss
  // frontend/src/assets/styles/_mixins.scss
  @mixin desktop {
    @media (min-width: 1200px) { @content; }
  }
  
  @mixin laptop {
    @media (min-width: 992px) and (max-width: 1199px) { @content; }
  }
  
  @mixin tablet {
    @media (max-width: 991px) { @content; }
  }
  ```

#### éªŒæ”¶æ ‡å‡†
- âœ… `npm run dev` å¯ä»¥æ­£å¸¸å¯åŠ¨
- âœ… å¼•å…¥SCSSå˜é‡åæ ·å¼æ­£å¸¸ç¼–è¯‘
- âœ… wavesurfer.js å¯ä»¥è¢«æ­£ç¡®å¼•å…¥ï¼ˆæ§åˆ¶å°æ— æŠ¥é”™ï¼‰

---

### é˜¶æ®µ 1ï¼šåŸºç¡€è®¾æ–½æ­å»ºï¼ˆé¢„è®¡2-3å¤©ï¼‰

#### 1.1 åˆ›å»º projectStore

**æ–‡ä»¶ï¼š** `frontend/src/stores/projectStore.js`

- [ ] å®ç°ä¸Šè¿° [3.1 Pinia Storeè®¾è®¡](#31-pinia-store-è®¾è®¡projectstorejs) çš„å®Œæ•´ä»£ç 
- [ ] ç¼–å†™ `parseSRT` å’Œ `generateSRT` å‡½æ•°ï¼ˆå‚è€ƒç°æœ‰SRTæ ¼å¼ï¼‰
- [ ] æ·»åŠ  localStorage è‡ªåŠ¨ä¿å­˜ï¼ˆé˜²æ­¢å´©æºƒä¸¢å¤±ï¼‰
  ```javascript
  watch(() => subtitles.value, () => {
    if (meta.value.jobId) {
      localStorage.setItem(
        `project-${meta.value.jobId}`,
        JSON.stringify({ subtitles: subtitles.value, meta: meta.value })
      )
    }
  }, { deep: true, throttle: 3000 }) // 3ç§’èŠ‚æµ
  ```

#### 1.2 åˆ›å»ºç¼–è¾‘å™¨ä¸»è§†å›¾

**æ–‡ä»¶ï¼š** `frontend/src/views/EditorView.vue`

```vue
<template>
  <div class="editor-view">
    <!-- é¡¶éƒ¨å·¥å…·æ  -->
    <header class="editor-header">
      <div class="left">
        <h2>{{ projectStore.meta.filename }}</h2>
        <span class="save-status">{{ saveStatus }}</span>
      </div>
      <div class="right">
        <!-- æ’¤é”€/é‡åšæŒ‰é’® -->
        <el-button-group>
          <el-button @click="projectStore.undo" :disabled="!projectStore.canUndo" title="æ’¤é”€ (Ctrl+Z)">
            <el-icon><RefreshLeft /></el-icon>
          </el-button>
          <el-button @click="projectStore.redo" :disabled="!projectStore.canRedo" title="é‡åš (Ctrl+Y)">
            <el-icon><RefreshRight /></el-icon>
          </el-button>
        </el-button-group>

        <!-- ä¸»é¢˜åˆ‡æ¢ -->
        <el-button @click="toggleTheme" circle>
          <el-icon><Moon v-if="isDark" /><Sunny v-else /></el-icon>
        </el-button>

        <!-- å¯¼å‡ºæŒ‰é’® -->
        <el-button @click="exportSRT" type="primary">å¯¼å‡ºSRT</el-button>
      </div>
    </header>

    <!-- å·¥ä½œåŒºï¼ˆå¯æ‹–æ‹½åˆ†æ ï¼‰ -->
    <div class="editor-workspace">
      <!-- å·¦ä¾§ï¼šè§†é¢‘ç›‘è§†å™¨ -->
      <div class="video-panel" ref="videoPanelRef">
        <VideoStage />
      </div>

      <!-- å³ä¾§ï¼šå­—å¹•ç¼–è¾‘å™¨ -->
      <div class="script-panel" ref="scriptPanelRef">
        <ScriptEditor />
      </div>
    </div>

    <!-- åº•éƒ¨æ§åˆ¶å° -->
    <footer class="editor-footer">
      <PlaybackControls />
      <WaveformTimeline />
    </footer>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue'
import { useDark, useToggle } from '@vueuse/core'
import { useProjectStore } from '@/stores/projectStore'

const projectStore = useProjectStore()
const isDark = useDark()
const toggleTheme = useToggle(isDark)

const saveStatus = computed(() => {
  if (projectStore.isDirty) return 'æœªä¿å­˜'
  return `å·²ä¿å­˜ ${new Date(projectStore.meta.lastSaved).toLocaleTimeString()}`
})

function exportSRT() {
  const srtContent = projectStore.generateSRT()
  const blob = new Blob([srtContent], { type: 'text/plain;charset=utf-8' })
  const url = URL.createObjectURL(blob)
  const link = document.createElement('a')
  link.href = url
  link.download = `${projectStore.meta.filename}.srt`
  link.click()
}
</script>

<style lang="scss" scoped>
.editor-view {
  display: flex;
  flex-direction: column;
  height: 100vh;
  background: var(--bg-primary);
}

.editor-header {
  display: flex;
  justify-content: space-between;
  padding: 16px 24px;
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border-color);
}

.editor-workspace {
  display: grid;
  grid-template-columns: 1fr 400px; // å·¦ä¾§è‡ªé€‚åº”ï¼Œå³ä¾§å›ºå®šå®½åº¦
  flex: 1;
  overflow: hidden;

  @include tablet {
    grid-template-columns: 1fr; // å°å±å¹•å•åˆ—
  }
}

.editor-footer {
  display: flex;
  flex-direction: column;
  height: 200px;
  background: var(--bg-secondary);
  border-top: 1px solid var(--border-color);
}
</style>
```

#### 1.3 é…ç½®è·¯ç”±ï¼ˆå¦‚æœéœ€è¦ï¼‰

**æ–‡ä»¶ï¼š** `frontend/src/router/index.js`ï¼ˆæ–°å»ºï¼‰

```javascript
import { createRouter, createWebHistory } from 'vue-router'
import App from '@/App.vue'
import EditorView from '@/views/EditorView.vue'

const routes = [
  { path: '/', component: App },
  { path: '/editor/:jobId', component: EditorView, props: true }
]

export const router = createRouter({
  history: createWebHistory(),
  routes
})
```

**ä¿®æ”¹ï¼š** `frontend/src/main.js`

```javascript
import { createApp } from 'vue'
import { createPinia } from 'pinia'
import ElementPlus from 'element-plus'
import 'element-plus/dist/index.css'
import App from './App.vue'
import { router } from './router'

const app = createApp(App)
app.use(createPinia())
app.use(ElementPlus)
app.use(router)
app.mount('#app')
```

#### éªŒæ”¶æ ‡å‡†
- âœ… EditorView é¡µé¢å¯ä»¥æ­£å¸¸æ¸²æŸ“ï¼ˆç©ºç™½ç»„ä»¶å ä½ç¬¦ï¼‰
- âœ… ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½æ­£å¸¸ï¼ˆæ·±è‰²/æµ…è‰²æ¨¡å¼ï¼‰
- âœ… projectStore å¯ä»¥æ­£ç¡®å¯¼å…¥/å¯¼å‡ºSRTæ•°æ®

---

### é˜¶æ®µ 2ï¼šè§†é¢‘æ’­æ”¾å™¨å®ç°ï¼ˆé¢„è®¡2å¤©ï¼‰

#### 2.1 åˆ›å»º VideoStage ç»„ä»¶

**æ–‡ä»¶ï¼š** `frontend/src/components/editor/VideoStage/index.vue`

```vue
<template>
  <div class="video-stage">
    <div class="video-container" ref="containerRef">
      <video
        ref="videoRef"
        :src="videoUrl"
        @loadedmetadata="onMetadataLoaded"
        @timeupdate="onTimeUpdate"
        @play="onPlay"
        @pause="onPause"
      />

      <!-- å­—å¹•è¦†ç›–å±‚ -->
      <div class="subtitle-overlay">
        {{ currentSubtitleText }}
      </div>
    </div>

    <!-- è§†é¢‘ä¿¡æ¯ -->
    <div class="video-info">
      <span>{{ formatTime(projectStore.player.currentTime) }} / {{ formatTime(projectStore.meta.duration) }}</span>
      <span>{{ projectStore.meta.filename }}</span>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, watch } from 'vue'
import { useProjectStore } from '@/stores/projectStore'

const projectStore = useProjectStore()
const videoRef = ref(null)
const containerRef = ref(null)

const videoUrl = computed(() => {
  if (!projectStore.meta.jobId) return ''
  return `/api/media/${projectStore.meta.jobId}/video` // åç«¯éœ€æä¾›æ­¤æ¥å£
})

const currentSubtitleText = computed(() => {
  return projectStore.currentSubtitle?.text || ''
})

// ç›‘å¬ Store ä¸­çš„æ’­æ”¾çŠ¶æ€å˜åŒ–
watch(() => projectStore.player.isPlaying, (playing) => {
  if (!videoRef.value) return
  if (playing) {
    videoRef.value.play()
  } else {
    videoRef.value.pause()
  }
})

// ç›‘å¬ Store ä¸­çš„æ—¶é—´è·³è½¬
watch(() => projectStore.player.currentTime, (newTime) => {
  if (!videoRef.value) return
  // é¿å…å¾ªç¯è§¦å‘ï¼ˆå·®å€¼å¤§äº0.1ç§’æ‰åŒæ­¥ï¼‰
  if (Math.abs(videoRef.value.currentTime - newTime) > 0.1) {
    videoRef.value.currentTime = newTime
  }
})

// ç›‘å¬æ’­æ”¾é€Ÿåº¦å˜åŒ–
watch(() => projectStore.player.playbackRate, (rate) => {
  if (videoRef.value) {
    videoRef.value.playbackRate = rate
  }
})

function onMetadataLoaded() {
  projectStore.meta.duration = videoRef.value.duration
}

function onTimeUpdate() {
  projectStore.player.currentTime = videoRef.value.currentTime
}

function onPlay() {
  projectStore.player.isPlaying = true
}

function onPause() {
  projectStore.player.isPlaying = false
}

function formatTime(sec) {
  const m = Math.floor(sec / 60)
  const s = Math.floor(sec % 60)
  return `${m}:${s.toString().padStart(2, '0')}`
}
</script>

<style lang="scss" scoped>
.video-stage {
  display: flex;
  flex-direction: column;
  height: 100%;
  padding: 16px;
}

.video-container {
  position: relative;
  flex: 1;
  background: #000;
  display: flex;
  align-items: center;
  justify-content: center;

  video {
    max-width: 100%;
    max-height: 100%;
  }
}

.subtitle-overlay {
  position: absolute;
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 8px 16px;
  border-radius: 4px;
  font-size: 24px;
  max-width: 80%;
  text-align: center;
}

.video-info {
  display: flex;
  justify-content: space-between;
  padding: 12px 0;
  color: var(--text-muted);
  font-size: 14px;
}
</style>
```

#### 2.2 åˆ›å»ºæ’­æ”¾æ§åˆ¶ç»„ä»¶

**æ–‡ä»¶ï¼š** `frontend/src/components/editor/Controls/PlaybackBar.vue`

```vue
<template>
  <div class="playback-bar">
    <!-- æ’­æ”¾/æš‚åœ -->
    <el-button @click="togglePlay" circle>
      <el-icon><VideoPlay v-if="!isPlaying" /><VideoPause v-else /></el-icon>
    </el-button>

    <!-- æ—¶é—´æ˜¾ç¤º -->
    <span class="time-display">
      {{ formatTime(currentTime) }} / {{ formatTime(duration) }}
    </span>

    <!-- å€é€Ÿæ§åˆ¶ -->
    <div class="playback-rate">
      <el-slider
        v-model="playbackRate"
        :min="0.5"
        :max="4.0"
        :step="0.1"
        :show-tooltip="true"
        style="width: 120px;"
      />
      <el-input-number
        v-model="playbackRate"
        :min="0.5"
        :max="4.0"
        :step="0.1"
        :precision="1"
        size="small"
        style="width: 80px; margin-left: 8px;"
      />
      <span>å€é€Ÿ</span>
    </div>

    <!-- éŸ³é‡ -->
    <div class="volume-control">
      <el-icon><Mute v-if="volume === 0" /><Sound v-else /></el-icon>
      <el-slider v-model="volume" :min="0" :max="1" :step="0.01" style="width: 100px; margin-left: 8px;" />
    </div>
  </div>
</template>

<script setup>
import { computed } from 'vue'
import { useProjectStore } from '@/stores/projectStore'

const projectStore = useProjectStore()

const isPlaying = computed(() => projectStore.player.isPlaying)
const currentTime = computed(() => projectStore.player.currentTime)
const duration = computed(() => projectStore.meta.duration)

const playbackRate = computed({
  get: () => projectStore.player.playbackRate,
  set: (val) => projectStore.player.playbackRate = val
})

const volume = computed({
  get: () => projectStore.player.volume,
  set: (val) => projectStore.player.volume = val
})

function togglePlay() {
  projectStore.player.isPlaying = !projectStore.player.isPlaying
}

function formatTime(sec) {
  const m = Math.floor(sec / 60)
  const s = Math.floor(sec % 60)
  return `${m}:${s.toString().padStart(2, '0')}`
}
</script>

<style lang="scss" scoped>
.playback-bar {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 12px 24px;
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border-color);
}

.time-display {
  font-size: 14px;
  color: var(--text-normal);
  min-width: 120px;
}

.playback-rate,
.volume-control {
  display: flex;
  align-items: center;
  gap: 8px;
}
</style>
```

#### éªŒæ”¶æ ‡å‡†
- âœ… è§†é¢‘å¯ä»¥æ­£å¸¸æ’­æ”¾/æš‚åœ
- âœ… å€é€Ÿæ§åˆ¶ç”Ÿæ•ˆï¼ˆ0.5x - 4.0xï¼‰
- âœ… å½“å‰å­—å¹•ä¼šåœ¨è§†é¢‘ä¸‹æ–¹æ˜¾ç¤ºï¼ˆå³ä½¿åˆ—è¡¨æ˜¯ç©ºçš„ä¹Ÿä¸æŠ¥é”™ï¼‰

---

### é˜¶æ®µ 3ï¼šæ³¢å½¢æ—¶é—´è½´å®ç°ï¼ˆé¢„è®¡3-4å¤©ï¼‰â­æ ¸å¿ƒ

#### 3.1 åç«¯ï¼šæ–°å¢æ³¢å½¢å³°å€¼æ•°æ®ç”Ÿæˆæ¥å£

**æ–‡ä»¶ï¼š** `backend/app/api/routes/media_routes.py`ï¼ˆæ–°å»ºï¼‰

```python
from fastapi import APIRouter, HTTPException, Request
from fastapi.responses import FileResponse, JSONResponse, StreamingResponse
import os
import json
import subprocess
import asyncio
from pathlib import Path
from typing import Optional
import wave
import struct

router = APIRouter(prefix="/api/media", tags=["media"])

# æµè§ˆå™¨å…¼å®¹çš„è§†é¢‘æ ¼å¼ï¼ˆH.264ç¼–ç çš„MP4ï¼‰
BROWSER_COMPATIBLE_FORMATS = {'.mp4', '.webm'}
# éœ€è¦è½¬ç çš„æ ¼å¼
NEED_TRANSCODE_FORMATS = {'.mkv', '.avi', '.mov', '.wmv', '.flv'}

def get_ffmpeg_command():
    """è·å–FFmpegå‘½ä»¤ï¼ˆå…¼å®¹ç‹¬ç«‹æ‰“åŒ…ï¼‰"""
    from core.config import config
    return config.get_ffmpeg_command()

@router.get("/{job_id}/video")
async def get_video(job_id: str, request: Request):
    """
    è·å–è§†é¢‘æ–‡ä»¶ï¼ˆæ”¯æŒRangeè¯·æ±‚ï¼Œè‡ªåŠ¨Proxyè½¬ç ï¼‰

    ä¼˜å…ˆè¿”å›Proxyè§†é¢‘ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œå¦åˆ™è¿”å›æºè§†é¢‘
    """
    jobs_dir = Path("jobs")
    job_dir = jobs_dir / job_id

    if not job_dir.exists():
        raise HTTPException(status_code=404, detail="ä»»åŠ¡ä¸å­˜åœ¨")

    # 1. æŸ¥æ‰¾Proxyè§†é¢‘ï¼ˆä¼˜å…ˆï¼‰
    proxy_video = job_dir / "proxy.mp4"
    if proxy_video.exists():
        return _serve_video_with_range(proxy_video, request)

    # 2. æŸ¥æ‰¾æºè§†é¢‘
    video_exts = ['.mp4', '.avi', '.mkv', '.mov', '.wmv', '.webm', '.flv']
    video_file = None
    for file in job_dir.iterdir():
        if file.suffix.lower() in video_exts:
            video_file = file
            break

    if not video_file:
        raise HTTPException(status_code=404, detail="è§†é¢‘æ–‡ä»¶ä¸å­˜åœ¨")

    # 3. æ£€æŸ¥æ˜¯å¦éœ€è¦ç”ŸæˆProxy
    if video_file.suffix.lower() in NEED_TRANSCODE_FORMATS:
        # å¼‚æ­¥ç”ŸæˆProxyè§†é¢‘ï¼ˆä¸é˜»å¡å½“å‰è¯·æ±‚ï¼‰
        asyncio.create_task(_generate_proxy_video(video_file, proxy_video))

        # è¿”å›æç¤ºä¿¡æ¯ï¼ˆå‰ç«¯åº”è½®è¯¢æˆ–ä½¿ç”¨WebSocketè·å–ç”ŸæˆçŠ¶æ€ï¼‰
        raise HTTPException(
            status_code=202,
            detail={
                "message": "è§†é¢‘æ ¼å¼ä¸å…¼å®¹ï¼Œæ­£åœ¨ç”Ÿæˆé¢„è§ˆç‰ˆæœ¬...",
                "format": video_file.suffix,
                "proxy_generating": True
            }
        )

    # 4. è¿”å›å…¼å®¹æ ¼å¼çš„æºè§†é¢‘
    return _serve_video_with_range(video_file, request)

def _serve_video_with_range(video_path: Path, request: Request):
    """
    æ”¯æŒHTTP Rangeè¯·æ±‚çš„è§†é¢‘æµå¼ä¼ è¾“ï¼ˆå…è®¸æ‹–æ‹½è¿›åº¦æ¡ï¼‰
    """
    file_size = video_path.stat().st_size
    range_header = request.headers.get("range")

    if not range_header:
        # æ— Rangeè¯·æ±‚ï¼Œè¿”å›å®Œæ•´æ–‡ä»¶
        return FileResponse(
            path=str(video_path),
            media_type='video/mp4',
            filename=video_path.name
        )

    # è§£æRangeå¤´ï¼šbytes=start-end
    byte_range = range_header.replace("bytes=", "").split("-")
    start = int(byte_range[0]) if byte_range[0] else 0
    end = int(byte_range[1]) if len(byte_range) > 1 and byte_range[1] else file_size - 1

    # è¿”å›éƒ¨åˆ†å†…å®¹ï¼ˆçŠ¶æ€ç 206ï¼‰
    def file_iterator():
        with open(video_path, "rb") as f:
            f.seek(start)
            remaining = end - start + 1
            chunk_size = 8192
            while remaining > 0:
                read_size = min(chunk_size, remaining)
                data = f.read(read_size)
                if not data:
                    break
                yield data
                remaining -= len(data)

    headers = {
        "Content-Range": f"bytes {start}-{end}/{file_size}",
        "Accept-Ranges": "bytes",
        "Content-Length": str(end - start + 1),
    }

    return StreamingResponse(
        file_iterator(),
        status_code=206,
        media_type='video/mp4',
        headers=headers
    )

async def _generate_proxy_video(source: Path, output: Path):
    """
    å¼‚æ­¥ç”ŸæˆProxyè§†é¢‘ï¼ˆ720p, H.264, é€‚åˆæµè§ˆå™¨é¢„è§ˆï¼‰
    """
    if output.exists():
        return  # å·²å­˜åœ¨ï¼Œè·³è¿‡

    ffmpeg_cmd = get_ffmpeg_command()
    cmd = [
        ffmpeg_cmd, '-i', str(source),
        '-vf', 'scale=-2:720',  # 720pï¼Œä¿æŒå®½é«˜æ¯”
        '-c:v', 'libx264',      # H.264ç¼–ç 
        '-preset', 'fast',      # å¿«é€Ÿç¼–ç 
        '-crf', '28',           # å‹ç¼©ç‡ï¼ˆ23-28é€‚åˆé¢„è§ˆï¼‰
        '-c:a', 'aac',          # AACéŸ³é¢‘
        '-b:a', '128k',         # éŸ³é¢‘æ¯”ç‰¹ç‡
        '-y',                   # è¦†ç›–è¾“å‡º
        str(output)
    ]

    try:
        print(f"ğŸ¬ å¼€å§‹ç”ŸæˆProxyè§†é¢‘: {source.name} -> proxy.mp4")
        process = await asyncio.create_subprocess_exec(
            *cmd,
            stdout=asyncio.subprocess.PIPE,
            stderr=asyncio.subprocess.PIPE
        )
        await process.communicate()

        if process.returncode == 0 and output.exists():
            print(f"âœ… Proxyè§†é¢‘ç”Ÿæˆå®Œæˆ: {output}")
        else:
            print(f"âŒ Proxyè§†é¢‘ç”Ÿæˆå¤±è´¥")
    except Exception as e:
        print(f"âŒ ç”ŸæˆProxyè§†é¢‘å¼‚å¸¸: {e}")

@router.get("/{job_id}/audio")
async def get_audio(job_id: str):
    """è·å–éŸ³é¢‘æ–‡ä»¶"""
    jobs_dir = Path("jobs")
    job_dir = jobs_dir / job_id
    audio_file = job_dir / "audio.wav"

    if not audio_file.exists():
        raise HTTPException(status_code=404, detail="éŸ³é¢‘æ–‡ä»¶ä¸å­˜åœ¨")

    return FileResponse(
        path=str(audio_file),
        media_type='audio/wav',
        filename='audio.wav'
    )

@router.get("/{job_id}/peaks")
async def get_audio_peaks(job_id: str, samples: int = 2000):
    """
    è·å–éŸ³é¢‘æ³¢å½¢å³°å€¼æ•°æ®ï¼ˆä¼˜åŒ–ç‰ˆï¼šæµå¼å¤„ç†ï¼Œé¿å…å¤§æ–‡ä»¶OOMï¼‰

    Args:
        job_id: ä»»åŠ¡ID
        samples: é‡‡æ ·ç‚¹æ•°ï¼ˆé»˜è®¤2000ï¼Œé€‚åˆ1-5åˆ†é’ŸéŸ³é¢‘ï¼‰

    Returns:
        JSON: { peaks: [min, max, min, max, ...], duration: 180.5 }
    """
    jobs_dir = Path("jobs")
    job_dir = jobs_dir / job_id
    audio_file = job_dir / "audio.wav"
    peaks_cache_file = job_dir / f"peaks_{samples}.json"

    # æ£€æŸ¥ç¼“å­˜
    if peaks_cache_file.exists():
        with open(peaks_cache_file, 'r') as f:
            return JSONResponse(json.load(f))

    if not audio_file.exists():
        raise HTTPException(status_code=404, detail="éŸ³é¢‘æ–‡ä»¶ä¸å­˜åœ¨")

    try:
        # ä½¿ç”¨æµå¼WAVè¯»å–ï¼ˆé¿å…åŠ è½½æ•´ä¸ªæ–‡ä»¶åˆ°å†…å­˜ï¼‰
        with wave.open(str(audio_file), 'rb') as wav:
            frame_rate = wav.getframerate()
            n_frames = wav.getnframes()
            sample_width = wav.getsampwidth()
            duration = n_frames / frame_rate

            # è®¡ç®—æ¯ä¸ªå³°å€¼çª—å£çš„å¸§æ•°
            chunk_frames = n_frames // samples
            peaks = []

            for i in range(samples):
                # è¯»å–å½“å‰çª—å£çš„å¸§æ•°æ®
                frames_data = wav.readframes(chunk_frames)

                if not frames_data:
                    peaks.extend([0.0, 0.0])
                    continue

                # è§£æPCMæ•°æ®
                if sample_width == 2:  # 16-bit
                    samples_chunk = struct.unpack(f'<{len(frames_data)//2}h', frames_data)
                    max_val = 32768.0
                elif sample_width == 4:  # 32-bit
                    samples_chunk = struct.unpack(f'<{len(frames_data)//4}i', frames_data)
                    max_val = 2147483648.0
                else:
                    samples_chunk = [0]
                    max_val = 1.0

                # å½’ä¸€åŒ–å¹¶è®¡ç®— min/max
                normalized = [s / max_val for s in samples_chunk]
                peaks.append(float(min(normalized)))
                peaks.append(float(max(normalized)))

        result = {
            "peaks": peaks,
            "duration": duration
        }

        # ç¼“å­˜ç»“æœ
        with open(peaks_cache_file, 'w') as f:
            json.dump(result, f)

        return JSONResponse(result)

    except Exception as e:
        raise HTTPException(status_code=500, detail=f"æ³¢å½¢æ•°æ®ç”Ÿæˆå¤±è´¥: {str(e)}")

@router.get("/{job_id}/proxy-status")
async def check_proxy_status(job_id: str):
    """æ£€æŸ¥Proxyè§†é¢‘ç”ŸæˆçŠ¶æ€"""
    jobs_dir = Path("jobs")
    job_dir = jobs_dir / job_id
    proxy_video = job_dir / "proxy.mp4"

    return JSONResponse({
        "exists": proxy_video.exists(),
        "size": proxy_video.stat().st_size if proxy_video.exists() else 0
    })
```

**æ³¨å†Œè·¯ç”±ï¼š** åœ¨ `backend/app/main.py` ä¸­æ·»åŠ 

```python
from api.routes import media_routes
app.include_router(media_routes.router)
```

#### 3.2 å‰ç«¯ï¼šåˆ›å»ºæ³¢å½¢æ—¶é—´è½´ç»„ä»¶

**æ–‡ä»¶ï¼š** `frontend/src/components/editor/Timeline/index.vue`

```vue
<template>
  <div class="waveform-timeline" ref="containerRef">
    <div id="waveform" ref="waveformRef"></div>
    <div id="timeline" ref="timelineRef"></div>
  </div>
</template>

<script setup>
import { ref, onMounted, watch } from 'vue'
import WaveSurfer from 'wavesurfer.js'
import RegionsPlugin from 'wavesurfer.js/dist/plugins/regions.js'
import TimelinePlugin from 'wavesurfer.js/dist/plugins/timeline.js'
import { useProjectStore } from '@/stores/projectStore'
import { ElMessage } from 'element-plus'

const projectStore = useProjectStore()
const waveformRef = ref(null)
const timelineRef = ref(null)
const containerRef = ref(null)

let wavesurfer = null
let regionsPlugin = null

onMounted(async () => {
  await initWavesurfer()
  loadPeaksData()
})

async function initWavesurfer() {
  // åˆ›å»º Regions æ’ä»¶
  regionsPlugin = RegionsPlugin.create()

  // åˆ›å»º Timeline æ’ä»¶
  const timelinePlugin = TimelinePlugin.create({
    container: timelineRef.value
  })

  // åˆå§‹åŒ– WaveSurfer
  wavesurfer = WaveSurfer.create({
    container: waveformRef.value,
    waveColor: '#4a9eff',
    progressColor: '#1e90ff',
    cursorColor: '#ff0000',
    height: 128,
    normalize: true,
    backend: 'MediaElement', // å¤ç”¨è§†é¢‘çš„éŸ³è½¨ï¼Œé¿å…åŠ è½½ä¸¤æ¬¡
    plugins: [regionsPlugin, timelinePlugin]
  })

  // ç›‘å¬æ’­æ”¾çŠ¶æ€
  wavesurfer.on('play', () => {
    projectStore.player.isPlaying = true
  })

  wavesurfer.on('pause', () => {
    projectStore.player.isPlaying = false
  })

  wavesurfer.on('timeupdate', (currentTime) => {
    projectStore.player.currentTime = currentTime
  })

  wavesurfer.on('ready', () => {
    renderSubtitleRegions()
  })

  // ç›‘å¬ Region æ‹–æ‹½
  regionsPlugin.on('region-update-end', (region) => {
    const subtitleId = region.id
    projectStore.updateSubtitle(subtitleId, {
      start: region.start,
      end: region.end
    })
  })

  // ç›‘å¬ Region ç‚¹å‡»ï¼ˆè·³è½¬æ’­æ”¾ï¼‰
  regionsPlugin.on('region-clicked', (region) => {
    projectStore.seekTo(region.start)
    wavesurfer.play()
  })
}

async function loadPeaksData() {
  if (!projectStore.meta.jobId) return

  try {
    const response = await fetch(`/api/media/${projectStore.meta.jobId}/peaks?samples=2000`)
    const data = await response.json()

    // ä½¿ç”¨åç«¯å³°å€¼æ•°æ®ï¼ˆæå¿«æ¸²æŸ“ï¼‰
    wavesurfer.load(
      `/api/media/${projectStore.meta.jobId}/audio`,
      data.peaks,
      data.duration
    )
  } catch (error) {
    ElMessage.error('æ³¢å½¢æ•°æ®åŠ è½½å¤±è´¥')
    console.error(error)
  }
}

function renderSubtitleRegions() {
  // æ¸…é™¤æ—§ Regions
  regionsPlugin.clearRegions()

  // æ¸²æŸ“æ–° Regions
  projectStore.subtitles.forEach(subtitle => {
    regionsPlugin.addRegion({
      id: subtitle.id,
      start: subtitle.start,
      end: subtitle.end,
      color: 'rgba(0, 123, 255, 0.3)',
      drag: true,
      resize: true
    })
  })
}

// ç›‘å¬ Store ä¸­çš„å­—å¹•å˜åŒ–ï¼Œé‡æ–°æ¸²æŸ“ Regions
watch(() => projectStore.subtitles, () => {
  if (wavesurfer && wavesurfer.isReady) {
    renderSubtitleRegions()
  }
}, { deep: true })

// ç›‘å¬ Store ä¸­çš„æ’­æ”¾çŠ¶æ€å˜åŒ–
watch(() => projectStore.player.isPlaying, (playing) => {
  if (!wavesurfer) return
  if (playing) {
    wavesurfer.play()
  } else {
    wavesurfer.pause()
  }
})

// ç›‘å¬ Store ä¸­çš„æ—¶é—´è·³è½¬
watch(() => projectStore.player.currentTime, (newTime) => {
  if (!wavesurfer) return
  if (Math.abs(wavesurfer.getCurrentTime() - newTime) > 0.1) {
    wavesurfer.seekTo(newTime / wavesurfer.getDuration())
  }
})
</script>

<style lang="scss" scoped>
.waveform-timeline {
  height: 100%;
  padding: 16px;
  background: var(--bg-secondary);
}

#waveform {
  height: 128px;
}

#timeline {
  height: 24px;
  margin-top: 8px;
}
</style>
```

#### éªŒæ”¶æ ‡å‡†
- âœ… æ³¢å½¢å¯ä»¥æ­£å¸¸æ¸²æŸ“ï¼ˆä½¿ç”¨åç«¯å³°å€¼æ•°æ®ï¼Œç§’å¼€ï¼‰
- âœ… æ‹–æ‹½ Region è¾¹ç¼˜å¯ä»¥è°ƒæ•´å­—å¹•æ—¶é—´
- âœ… ç‚¹å‡» Region å¯ä»¥è·³è½¬æ’­æ”¾
- âœ… æ³¢å½¢æ’­æ”¾è¿›åº¦ä¸è§†é¢‘åŒæ­¥

---

### é˜¶æ®µ 4ï¼šå­—å¹•åˆ—è¡¨å®ç°ï¼ˆé¢„è®¡2-3å¤©ï¼‰

#### 4.1 åˆ›å»ºå­—å¹•åˆ—è¡¨ç»„ä»¶

**æ–‡ä»¶ï¼š** `frontend/src/components/editor/ScriptEditor/ListMode.vue`

```vue
<template>
  <div class="subtitle-list">
    <div class="list-header">
      <h3>å­—å¹•åˆ—è¡¨ ({{ totalSubtitles }})</h3>
      <el-button @click="addNewSubtitle" size="small" type="primary">
        <el-icon><Plus /></el-icon> æ–°å¢
      </el-button>
    </div>

    <!-- è™šæ‹Ÿæ»šåŠ¨åˆ—è¡¨ -->
    <RecycleScroller
      class="scroller"
      :items="subtitles"
      :item-size="80"
      key-field="id"
      v-slot="{ item, index }"
    >
      <div
        class="subtitle-item"
        :class="{ active: isActive(item.id), current: isCurrent(item.id) }"
        @click="onSubtitleClick(item)"
      >
        <div class="subtitle-index">{{ index + 1 }}</div>

        <div class="subtitle-content">
          <!-- æ—¶é—´ç¼–è¾‘ -->
          <div class="time-inputs">
            <el-input
              :model-value="formatTime(item.start)"
              @change="(val) => updateTime(item.id, 'start', val)"
              size="small"
              placeholder="00:00:00.000"
            />
            <span>â†’</span>
            <el-input
              :model-value="formatTime(item.end)"
              @change="(val) => updateTime(item.id, 'end', val)"
              size="small"
              placeholder="00:00:00.000"
            />
          </div>

          <!-- æ–‡æœ¬ç¼–è¾‘ -->
          <el-input
            :model-value="item.text"
            @input="(val) => updateText(item.id, val)"
            type="textarea"
            :rows="2"
            placeholder="è¾“å…¥å­—å¹•æ–‡æœ¬..."
          />
        </div>

        <div class="subtitle-actions">
          <el-button @click.stop="deleteSubtitle(item.id)" size="small" type="danger" circle>
            <el-icon><Delete /></el-icon>
          </el-button>
        </div>
      </div>
    </RecycleScroller>
  </div>
</template>

<script setup>
import { computed } from 'vue'
import { RecycleScroller } from 'vue-virtual-scroller'
import 'vue-virtual-scroller/dist/vue-virtual-scroller.css'
import { useProjectStore } from '@/stores/projectStore'

const projectStore = useProjectStore()

const subtitles = computed(() => projectStore.subtitles)
const totalSubtitles = computed(() => projectStore.totalSubtitles)

function isActive(id) {
  return projectStore.view.selectedSubtitleId === id
}

function isCurrent(id) {
  return projectStore.currentSubtitle?.id === id
}

function onSubtitleClick(subtitle) {
  projectStore.view.selectedSubtitleId = subtitle.id
  projectStore.seekTo(subtitle.start)
}

function updateTime(id, field, timeStr) {
  const seconds = parseTimeString(timeStr)
  projectStore.updateSubtitle(id, { [field]: seconds })
}

function updateText(id, text) {
  projectStore.updateSubtitle(id, { text })
}

function deleteSubtitle(id) {
  projectStore.removeSubtitle(id)
}

function addNewSubtitle() {
  const lastSubtitle = subtitles.value[subtitles.value.length - 1]
  const newStart = lastSubtitle ? lastSubtitle.end : 0
  projectStore.addSubtitle(subtitles.value.length, {
    start: newStart,
    end: newStart + 3,
    text: ''
  })
}

function formatTime(seconds) {
  const h = Math.floor(seconds / 3600)
  const m = Math.floor((seconds % 3600) / 60)
  const s = Math.floor(seconds % 60)
  const ms = Math.round((seconds % 1) * 1000)
  return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}.${ms.toString().padStart(3, '0')}`
}

function parseTimeString(timeStr) {
  // "00:01:23.456" => 83.456
  const [time, ms] = timeStr.split('.')
  const [h, m, s] = time.split(':').map(Number)
  return h * 3600 + m * 60 + s + (ms ? parseInt(ms) / 1000 : 0)
}
</script>

<style lang="scss" scoped>
.subtitle-list {
  display: flex;
  flex-direction: column;
  height: 100%;
  background: var(--bg-primary);
}

.list-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
  border-bottom: 1px solid var(--border-color);
}

.scroller {
  flex: 1;
  overflow-y: auto;
}

.subtitle-item {
  display: flex;
  gap: 12px;
  padding: 12px;
  border-bottom: 1px solid var(--border-color);
  cursor: pointer;
  transition: background 0.2s;

  &:hover {
    background: rgba(255, 255, 255, 0.05);
  }

  &.active {
    background: rgba(64, 158, 255, 0.2);
  }

  &.current {
    border-left: 3px solid #409eff;
  }
}

.subtitle-index {
  min-width: 40px;
  text-align: center;
  color: var(--text-muted);
  font-size: 14px;
}

.subtitle-content {
  flex: 1;
}

.time-inputs {
  display: flex;
  gap: 8px;
  align-items: center;
  margin-bottom: 8px;

  span {
    color: var(--text-muted);
  }
}

.subtitle-actions {
  display: flex;
  align-items: center;
}
</style>
```

#### éªŒæ”¶æ ‡å‡†
- âœ… å­—å¹•åˆ—è¡¨å¯ä»¥æ­£å¸¸æ¸²æŸ“ï¼ˆæ”¯æŒ1000+æ¡å­—å¹•æ— å¡é¡¿ï¼‰
- âœ… ç‚¹å‡»å­—å¹•å¯ä»¥è·³è½¬æ’­æ”¾
- âœ… ç¼–è¾‘æ—¶é—´/æ–‡æœ¬å¯ä»¥å®æ—¶åŒæ­¥åˆ°æ³¢å½¢
- âœ… å½“å‰æ’­æ”¾å­—å¹•ä¼šé«˜äº®æ˜¾ç¤º

---

### é˜¶æ®µ 5ï¼šé›†æˆæµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆé¢„è®¡2å¤©ï¼‰

#### 5.1 å®Œæ•´æµç¨‹æµ‹è¯•

- [ ] **æµ‹è¯•åœºæ™¯1ï¼šä»è½¬å½•ç»“æœè¿›å…¥ç¼–è¾‘å™¨**
  1. åœ¨ App.vue ä¸­å®Œæˆè½¬å½•ä»»åŠ¡
  2. ç‚¹å‡»"ç¼–è¾‘å­—å¹•"æŒ‰é’®è¿›å…¥ EditorView
  3. è‡ªåŠ¨åŠ è½½ SRT æ–‡ä»¶åˆ° projectStore
  4. éªŒè¯è§†é¢‘/æ³¢å½¢/å­—å¹•åˆ—è¡¨éƒ½æ­£å¸¸æ˜¾ç¤º

- [ ] **æµ‹è¯•åœºæ™¯2ï¼šå­—å¹•ç¼–è¾‘æ“ä½œ**
  1. æ‹–æ‹½æ³¢å½¢ Region â†’ åˆ—è¡¨æ—¶é—´æ›´æ–°
  2. ä¿®æ”¹åˆ—è¡¨æ—¶é—´ â†’ æ³¢å½¢ Region ä½ç½®æ›´æ–°
  3. ç¼–è¾‘å­—å¹•æ–‡æœ¬ â†’ Store æ ‡è®°ä¸ºè„çŠ¶æ€
  4. ç‚¹å‡»å¯¼å‡º â†’ ç”Ÿæˆæ­£ç¡®çš„ SRT æ–‡ä»¶

- [ ] **æµ‹è¯•åœºæ™¯3ï¼šæ’­æ”¾åŒæ­¥**
  1. æ’­æ”¾è§†é¢‘ â†’ æ³¢å½¢è¿›åº¦æ¡è·Ÿéš
  2. æ³¢å½¢æ’­æ”¾ â†’ è§†é¢‘åŒæ­¥æ’­æ”¾
  3. ç‚¹å‡»å­—å¹• â†’ è§†é¢‘è·³è½¬åˆ°å¯¹åº”ä½ç½®

#### 5.2 æ€§èƒ½ä¼˜åŒ–

- [ ] **æ³¢å½¢åŠ è½½ä¼˜åŒ–**
  - ç¡®è®¤åç«¯å³°å€¼æ•°æ®ç¼“å­˜ç”Ÿæ•ˆ
  - æµ‹è¯• 5åˆ†é’Ÿ+ éŸ³é¢‘åŠ è½½æ—¶é—´ < 1ç§’

- [ ] **åˆ—è¡¨æ¸²æŸ“ä¼˜åŒ–**
  - ä½¿ç”¨ vue-virtual-scroller
  - æµ‹è¯• 1000æ¡å­—å¹•æ»šåŠ¨æµç•…åº¦

- [ ] **å†…å­˜ä¼˜åŒ–**
  - ç¦»å¼€ç¼–è¾‘å™¨æ—¶é”€æ¯ wavesurfer å®ä¾‹
  - æ¸…ç†äº‹ä»¶ç›‘å¬å™¨

#### 5.3 é”™è¯¯å¤„ç†

- [ ] **èµ„æºåŠ è½½å¤±è´¥å¤„ç†**
  ```javascript
  // è§†é¢‘404 â†’ æ˜¾ç¤ºå ä½å›¾
  // éŸ³é¢‘404 â†’ é™çº§ä¸ºçº¯æ–‡æœ¬ç¼–è¾‘æ¨¡å¼
  // æ³¢å½¢æ•°æ®ç”Ÿæˆå¤±è´¥ â†’ å‰ç«¯è‡ªåŠ¨ç”Ÿæˆï¼ˆfallbackï¼‰
  ```

- [ ] **æœªä¿å­˜æç¤º**
  ```javascript
  // EditorView.vue
  onBeforeRouteLeave((to, from, next) => {
    if (projectStore.isDirty) {
      ElMessageBox.confirm('æœ‰æœªä¿å­˜çš„ä¿®æ”¹ï¼Œç¡®å®šç¦»å¼€å—ï¼Ÿ')
        .then(() => next())
        .catch(() => next(false))
    } else {
      next()
    }
  })
  ```

---

## 5. æŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ

### 5.1 æ³¢å½¢ä¸å­—å¹•åŒå‘ç»‘å®š

**é—®é¢˜ï¼š** Regionæ‹–æ‹½ â†’ Storeæ›´æ–° â†’ Regioné‡ç»˜ â†’ è§¦å‘æ— é™å¾ªç¯

**è§£å†³æ–¹æ¡ˆï¼š**

```javascript
// åœ¨ region-update-end äº‹ä»¶ä¸­åªæ›´æ–° Store
regionsPlugin.on('region-update-end', (region) => {
  projectStore.updateSubtitle(region.id, {
    start: region.start,
    end: region.end
  })
})

// åœ¨ Store watch ä¸­åˆ¤æ–­å·®å€¼ï¼Œé¿å…é‡å¤æ¸²æŸ“
watch(() => projectStore.subtitles, (newSubtitles) => {
  newSubtitles.forEach(subtitle => {
    const region = regionsPlugin.getRegionById(subtitle.id)
    if (region) {
      // åªæœ‰å·®å€¼è¾ƒå¤§æ—¶æ‰æ›´æ–°ï¼ˆé¿å…æ‹–æ‹½æ—¶çš„å¾ªç¯ï¼‰
      if (Math.abs(region.start - subtitle.start) > 0.01 ||
          Math.abs(region.end - subtitle.end) > 0.01) {
        region.update({ start: subtitle.start, end: subtitle.end })
      }
    }
  })
}, { deep: true })
```

### 5.2 é•¿éŸ³é¢‘æ€§èƒ½é—®é¢˜

**é—®é¢˜ï¼š** 1å°æ—¶éŸ³é¢‘ â†’ wavesurferè§£ç  â†’ æµè§ˆå™¨å¡æ­»

**è§£å†³æ–¹æ¡ˆï¼š**
- **åç«¯é¢„è®¡ç®—å³°å€¼æ•°æ®**ï¼ˆå·²åœ¨é˜¶æ®µ3å®ç°ï¼‰
- ä½¿ç”¨ `backend` æ¨¡å¼å¤ç”¨ MediaElement
- ç¼“å­˜å³°å€¼æ•°æ®åˆ°æ–‡ä»¶ï¼Œé¿å…é‡å¤è®¡ç®—

### 5.3 æ—¶é—´ç²¾åº¦é—®é¢˜

**é—®é¢˜ï¼š** æµ®ç‚¹æ•°ç²¾åº¦ä¸¢å¤± â†’ å­—å¹•æ—¶é—´ä¸å‡†ç¡®

**è§£å†³æ–¹æ¡ˆï¼š**
```javascript
// ç»Ÿä¸€ä½¿ç”¨3ä½å°æ•°ç²¾åº¦
function roundTime(sec) {
  return Math.round(sec * 1000) / 1000
}

// æ—¶é—´æ¯”è¾ƒä½¿ç”¨å®¹å·®
function isTimeEqual(t1, t2, tolerance = 0.001) {
  return Math.abs(t1 - t2) < tolerance
}
```

### 5.4 è§†é¢‘æ ¼å¼æµè§ˆå™¨å…¼å®¹æ€§ â­â­â­

**é—®é¢˜ï¼š** HTML5 `<video>` æ ‡ç­¾åªåŸç”Ÿæ”¯æŒ MP4 (H.264)ã€WebM ç­‰å°‘æ•°æ ¼å¼ï¼ŒMKVã€AVIã€H.265 ç­‰æ ¼å¼æ— æ³•æ’­æ”¾

**å½±å“ï¼š** è½¬å½•æˆåŠŸï¼Œä½†ç¼–è¾‘å™¨ä¸­è§†é¢‘é»‘å±ï¼Œæ— æ³•é¢„è§ˆ

**è§£å†³æ–¹æ¡ˆï¼š**
1. **åç«¯è‡ªåŠ¨ç”Ÿæˆ Proxy è§†é¢‘**ï¼ˆå·²åœ¨é˜¶æ®µ3å®ç°ï¼‰
   - æ£€æµ‹è§†é¢‘æ ¼å¼ï¼Œå¦‚æœä¸å…¼å®¹åˆ™è‡ªåŠ¨è½¬ç ä¸º 720p H.264 MP4
   - ä½¿ç”¨ FFmpeg å¼‚æ­¥ç”Ÿæˆï¼Œä¸é˜»å¡ä¸»æµç¨‹
   - å‰ç«¯ä¼˜å…ˆè¯·æ±‚ Proxyï¼Œé™çº§ä½¿ç”¨æºæ–‡ä»¶

2. **å‰ç«¯é”™è¯¯å¤„ç†**
   ```vue
   <video
     ref="videoRef"
     :src="videoUrl"
     @error="handleVideoError"
     @waiting="isLoading = true"
     @canplay="isLoading = false"
   />

   <div v-if="videoError" class="video-error-placeholder">
     <el-icon><WarningFilled /></el-icon>
     <p>è§†é¢‘æ ¼å¼ä¸å…¼å®¹ï¼Œæ­£åœ¨ç”Ÿæˆé¢„è§ˆç‰ˆæœ¬...</p>
     <el-progress :percentage="proxyProgress" />
   </div>

   <script setup>
   async function handleVideoError() {
     videoError.value = true
     // è½®è¯¢æ£€æŸ¥ Proxy ç”ŸæˆçŠ¶æ€
     const timer = setInterval(async () => {
       const res = await fetch(`/api/media/${jobId}/proxy-status`)
       const data = await res.json()
       if (data.exists) {
         clearInterval(timer)
         videoUrl.value = `/api/media/${jobId}/video?t=${Date.now()}`
         videoError.value = false
       }
     }, 3000)
   }
   </script>
   ```

### 5.5 å¤§è§†é¢‘æ–‡ä»¶çš„ Range è¯·æ±‚æ”¯æŒ â­â­

**é—®é¢˜ï¼š** å¤§è§†é¢‘ï¼ˆ1GB+ï¼‰å¦‚æœä¸æ”¯æŒ HTTP Range è¯·æ±‚ï¼Œæµè§ˆå™¨æ— æ³•è·³è½¬è¿›åº¦æ¡ï¼ˆSeekï¼‰

**å½±å“ï¼š** ç”¨æˆ·æ‹–æ‹½è¿›åº¦æ¡æ—¶éœ€è¦é‡æ–°ä¸‹è½½æ•´ä¸ªæ–‡ä»¶ï¼Œä½“éªŒæå·®

**è§£å†³æ–¹æ¡ˆï¼š**
- **åç«¯å®ç° Range è¯·æ±‚æ”¯æŒ**ï¼ˆå·²åœ¨ media_routes.py å®ç°ï¼‰
  - è§£æ `Range: bytes=start-end` å¤´
  - è¿”å› 206 Partial Content çŠ¶æ€ç 
  - è®¾ç½® `Content-Range`ã€`Accept-Ranges` å“åº”å¤´
  - ä½¿ç”¨æµå¼ä¼ è¾“é¿å…å†…å­˜æº¢å‡º

**éªŒè¯æ–¹æ³•ï¼š**
```bash
# æµ‹è¯• Range è¯·æ±‚
curl -I -H "Range: bytes=0-1023" http://localhost:8000/api/media/{job_id}/video

# åº”è¯¥è¿”å›ï¼š
# HTTP/1.1 206 Partial Content
# Content-Range: bytes 0-1023/1234567890
# Accept-Ranges: bytes
```

### 5.6 æ³¢å½¢æ•°æ®ç”Ÿæˆå†…å­˜æº¢å‡º â­â­

**é—®é¢˜ï¼š** ä½¿ç”¨ `pydub` åŠ è½½å®Œæ•´éŸ³é¢‘åˆ°å†…å­˜ï¼Œ2å°æ—¶éŸ³é¢‘å¯èƒ½å¯¼è‡´åç«¯ OOM

**å½±å“ï¼š** åç«¯è¿›ç¨‹å´©æºƒï¼Œæ³¢å½¢æ— æ³•åŠ è½½

**è§£å†³æ–¹æ¡ˆï¼š**
1. **ä½¿ç”¨æµå¼ WAV è¯»å–**ï¼ˆå·²åœ¨ media_routes.py å®ç°ï¼‰
   - ä½¿ç”¨ Python æ ‡å‡†åº“ `wave` æ¨¡å—
   - åˆ†å—è¯»å–å¸§æ•°æ®ï¼Œé€æ­¥è®¡ç®—å³°å€¼
   - é¿å…ä¸€æ¬¡æ€§åŠ è½½æ•´ä¸ªæ–‡ä»¶

2. **äºŒæœŸä¼˜åŒ–ï¼šä½¿ç”¨ audiowaveform å‘½ä»¤è¡Œå·¥å…·**
   ```python
   # audiowaveform æ˜¯ä¸“ä¸šçš„æ³¢å½¢ç”Ÿæˆå·¥å…·ï¼ˆC++å®ç°ï¼Œæå¿«ï¼‰
   import subprocess
   cmd = [
       'audiowaveform',
       '-i', str(audio_file),
       '-o', str(peaks_cache_file),
       '-z', str(samples),
       '--pixels-per-second', '20'
   ]
   subprocess.run(cmd)
   ```

**å†…å­˜å¯¹æ¯”ï¼š**
- pydubï¼š2å°æ—¶éŸ³é¢‘ â‰ˆ 2GB å†…å­˜å ç”¨
- æµå¼è¯»å–ï¼š2å°æ—¶éŸ³é¢‘ â‰ˆ 50MB å†…å­˜å ç”¨
- audiowaveformï¼š2å°æ—¶éŸ³é¢‘ â‰ˆ 10MB å†…å­˜å ç”¨

---

## 6. æ–‡ä»¶ç»“æ„ä¸ç»„ç»‡

### 6.1 æœ€ç»ˆç›®å½•ç»“æ„

```
frontend/src/
â”œâ”€â”€ assets/
â”‚   â””â”€â”€ styles/
â”‚       â”œâ”€â”€ _variables.scss      # é¢œè‰²å˜é‡ã€ä¸»é¢˜å˜é‡
â”‚       â”œâ”€â”€ _mixins.scss         # å“åº”å¼æ–­ç‚¹
â”‚       â””â”€â”€ main.scss            # å…¨å±€æ ·å¼å…¥å£
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ editor/
â”‚   â”‚   â”œâ”€â”€ VideoStage/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.vue        # è§†é¢‘æ’­æ”¾å™¨å®¹å™¨
â”‚   â”‚   â”‚   â””â”€â”€ SubtitleOverlay.vue  # å­—å¹•è¦†ç›–å±‚ï¼ˆå¯é€‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ Timeline/
â”‚   â”‚   â”‚   â””â”€â”€ index.vue        # æ³¢å½¢æ—¶é—´è½´
â”‚   â”‚   â”œâ”€â”€ ScriptEditor/
â”‚   â”‚   â”‚   â”œâ”€â”€ ListMode.vue     # åˆ—è¡¨ç¼–è¾‘æ¨¡å¼
â”‚   â”‚   â”‚   â””â”€â”€ DocumentMode.vue # æ–‡ç¨¿ç¼–è¾‘æ¨¡å¼ï¼ˆäºŒæœŸï¼‰
â”‚   â”‚   â””â”€â”€ Controls/
â”‚   â”‚       â”œâ”€â”€ PlaybackBar.vue  # æ’­æ”¾æ§åˆ¶æ¡
â”‚   â”‚       â””â”€â”€ TimeDisplay.vue  # æ—¶é—´æ˜¾ç¤ºï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ file-management/         # ï¼ˆå·²æœ‰ï¼‰æ–‡ä»¶ç®¡ç†ç»„ä»¶
â”‚   â”œâ”€â”€ hardware/                # ï¼ˆå·²æœ‰ï¼‰ç¡¬ä»¶ä¿¡æ¯ç»„ä»¶
â”‚   â”œâ”€â”€ models/                  # ï¼ˆå·²æœ‰ï¼‰æ¨¡å‹ç®¡ç†ç»„ä»¶
â”‚   â””â”€â”€ transcription/           # ï¼ˆå·²æœ‰ï¼‰è½¬å½•è®¾ç½®ç»„ä»¶
â”œâ”€â”€ composables/
â”‚   â”œâ”€â”€ useWaveform.js           # æ³¢å½¢é€»è¾‘å°è£…ï¼ˆå¯é€‰ï¼‰
â”‚   â””â”€â”€ useAutoSave.js           # è‡ªåŠ¨ä¿å­˜é€»è¾‘ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ stores/
â”‚   â”œâ”€â”€ modelStore.js            # ï¼ˆå·²æœ‰ï¼‰æ¨¡å‹çŠ¶æ€
â”‚   â””â”€â”€ projectStore.js          # ï¼ˆæ–°å¢ï¼‰å­—å¹•é¡¹ç›®çŠ¶æ€
â”œâ”€â”€ views/
â”‚   â”œâ”€â”€ EditorView.vue           # ç¼–è¾‘å™¨ä¸»è§†å›¾
â”‚   â””â”€â”€ ...                      # å…¶ä»–è§†å›¾
â”œâ”€â”€ router/
â”‚   â””â”€â”€ index.js                 # è·¯ç”±é…ç½®
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ api.js                   # ï¼ˆå·²æœ‰ï¼‰APIåŸºç¡€å°è£…
â”‚   â”œâ”€â”€ fileService.js           # ï¼ˆå·²æœ‰ï¼‰æ–‡ä»¶æœåŠ¡
â”‚   â”œâ”€â”€ modelManagerService.js   # ï¼ˆå·²æœ‰ï¼‰æ¨¡å‹ç®¡ç†æœåŠ¡
â”‚   â””â”€â”€ projectService.js        # ï¼ˆæ–°å¢ï¼‰å­—å¹•é¡¹ç›®æœåŠ¡
â””â”€â”€ main.js
```

```
backend/app/
â”œâ”€â”€ api/routes/
â”‚   â”œâ”€â”€ file_routes.py           # ï¼ˆå·²æœ‰ï¼‰æ–‡ä»¶ç®¡ç†
â”‚   â”œâ”€â”€ model_routes.py          # ï¼ˆå·²æœ‰ï¼‰æ¨¡å‹ç®¡ç†
â”‚   â”œâ”€â”€ transcription_routes.py  # ï¼ˆå·²æœ‰ï¼‰è½¬å½•ä»»åŠ¡
â”‚   â””â”€â”€ media_routes.py          # ï¼ˆæ–°å¢ï¼‰åª’ä½“èµ„æºå’Œæ³¢å½¢æ•°æ®
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ transcription_service.py # ï¼ˆå·²æœ‰ï¼‰è½¬å½•æœåŠ¡
â”‚   â”œâ”€â”€ model_manager_service.py # ï¼ˆå·²æœ‰ï¼‰æ¨¡å‹ç®¡ç†
â”‚   â””â”€â”€ subtitle_service.py      # ï¼ˆæ–°å¢ï¼‰å­—å¹•ç¼–è¾‘æœåŠ¡
â””â”€â”€ ...
```

---

## 7. è´¨é‡ä¿éšœç­–ç•¥

### 7.1 ç‹¬ç«‹å¼€å‘è€…æœ€ä½³å®è·µ

**ç®€åŒ–çš„è´¨é‡ä¿éšœæµç¨‹ï¼š**

1. **è‡ªæµ‹æ¸…å•ï¼ˆæ¯ä¸ªé˜¶æ®µç»“æŸæ—¶ï¼‰**
   
   - [ ] åŠŸèƒ½æ­£å¸¸è¿è¡Œï¼ˆæ— æ§åˆ¶å°é”™è¯¯ï¼‰
   - [ ] ç•Œé¢æ— æ˜æ˜¾æ ·å¼é”™è¯¯
   - [ ] æ ¸å¿ƒäº¤äº’æµç¨‹é¡ºç•…
   - [ ] åˆ·æ–°é¡µé¢ä¸å´©æºƒ
   
2. **ç‰ˆæœ¬æ§åˆ¶ï¼ˆGitåˆ†æ”¯ç­–ç•¥ï¼‰**
   
   ```bash
   main              # ç¨³å®šç‰ˆæœ¬ï¼ˆèƒ½è·‘çš„ä»£ç ï¼‰
   â”œâ”€â”€ feature/editor-base       # é˜¶æ®µ1-2
   â”œâ”€â”€ feature/waveform          # é˜¶æ®µ3
   â””â”€â”€ feature/subtitle-list     # é˜¶æ®µ4
   ```
   
3. **é€æ­¥é›†æˆï¼ˆé¿å…å¤§çˆ†ç‚¸é›†æˆï¼‰**
   - æ¯å®Œæˆä¸€ä¸ªé˜¶æ®µç«‹å³åˆå¹¶åˆ° main
   - ç¡®ä¿ main åˆ†æ”¯å§‹ç»ˆå¯è¿è¡Œ
   - é‡åˆ°é—®é¢˜å¯ä»¥å¿«é€Ÿå›é€€

### 7.2 å…³é”®æµ‹è¯•åœºæ™¯

| åœºæ™¯ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ |
|------|----------|--------|
| åŠ è½½è½¬å½•ç»“æœè¿›å…¥ç¼–è¾‘å™¨ | è§†é¢‘ã€æ³¢å½¢ã€å­—å¹•åˆ—è¡¨æ­£å¸¸æ˜¾ç¤º | P0 |
| æ‹–æ‹½æ³¢å½¢Region | å­—å¹•æ—¶é—´å®æ—¶æ›´æ–° | P0 |
| ç¼–è¾‘å­—å¹•æ–‡æœ¬ | Storeæ ‡è®°ä¸ºè„çŠ¶æ€ | P0 |
| å¯¼å‡ºSRT | æ–‡ä»¶å†…å®¹æ­£ç¡® | P0 |
| 1000+æ¡å­—å¹•æ»šåŠ¨ | æ— å¡é¡¿ | P1 |
| ä¸»é¢˜åˆ‡æ¢ | æ·±è‰²/æµ…è‰²æ­£å¸¸åˆ‡æ¢ | P1 |
| åˆ·æ–°é¡µé¢ | localStorageæ¢å¤çŠ¶æ€ | P2 |

### 7.3 å¸¸è§é—®é¢˜æ’æŸ¥

**é—®é¢˜1ï¼šæ³¢å½¢åŠ è½½å¤±è´¥**
```bash
# æ£€æŸ¥åç«¯æ¥å£
curl http://localhost:8000/api/media/{job_id}/peaks

# æ£€æŸ¥éŸ³é¢‘æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls jobs/{job_id}/audio.wav

# æŸ¥çœ‹åç«¯æ—¥å¿—
# ç¡®è®¤ numpy å’Œ pydub å·²å®‰è£…
```

**é—®é¢˜2ï¼šRegionæ‹–æ‹½æ— å“åº”**
```javascript
// æ£€æŸ¥ RegionsPlugin æ˜¯å¦æ­£ç¡®åˆå§‹åŒ–
console.log(regionsPlugin)

// æ£€æŸ¥äº‹ä»¶ç›‘å¬æ˜¯å¦ç»‘å®š
regionsPlugin.on('region-update-end', (region) => {
  console.log('Region updated:', region.id, region.start, region.end)
})
```

**é—®é¢˜3ï¼šå­—å¹•åˆ—è¡¨ä¸æ»šåŠ¨**
```vue
<!-- æ£€æŸ¥ RecycleScroller é«˜åº¦æ˜¯å¦è®¾ç½® -->
<RecycleScroller style="height: 500px;" ... />

<!-- æ£€æŸ¥æ˜¯å¦æ­£ç¡®å¼•å…¥ CSS -->
import 'vue-virtual-scroller/dist/vue-virtual-scroller.css'
```

---

## 8. åç»­æ‰©å±•è®¡åˆ’ï¼ˆäºŒæœŸï¼‰

### 8.1 é«˜çº§ç¼–è¾‘åŠŸèƒ½
1. **æ–‡ç¨¿ç¼–è¾‘æ¨¡å¼**ï¼šç±»ä¼¼ Word çš„å¤§æ®µæ–‡æœ¬ç¼–è¾‘
2. **å¿«æ·é”®ç³»ç»Ÿ**ï¼šç©ºæ ¼æ’­æ”¾/æš‚åœã€â† â†’ å¿«é€€/å¿«è¿›ã€Ctrl+Z/Y æ’¤é”€é‡åš
3. **æ‰¹é‡æ“ä½œ**ï¼šæ—¶é—´åç§»ã€åˆå¹¶å­—å¹•ã€åˆ†å‰²å­—å¹•

### 8.2 AIå¢å¼ºåŠŸèƒ½
1. **å­—å¹•ç¿»è¯‘**ï¼šé›†æˆç™¾åº¦/Googleç¿»è¯‘API
2. **è¯´è¯äººåˆ†ç¦»**ï¼špyannote.audio æ ‡è®°ä¸åŒè¯´è¯äºº
3. **æ ‡ç‚¹ä¼˜åŒ–**ï¼šAIè‡ªåŠ¨æ·»åŠ æ ‡ç‚¹ç¬¦å·

### 8.3 å¯¼å‡ºå¢å¼º
1. **è§†é¢‘çƒ§å½•**ï¼šFFmpeg ç¡¬å­—å¹•å‹åˆ¶
2. **å¤šæ ¼å¼å¯¼å‡º**ï¼šASSã€VTTã€TXT
3. **æ‰¹é‡å¯¼å‡º**ï¼šæ‰“åŒ…æ‰€æœ‰ä»»åŠ¡çš„å­—å¹•

---

## 9. æ€»ç»“

### 9.1 å¼€å‘æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | é¢„è®¡å·¥æ—¶ | ç´¯è®¡å·¥æ—¶ |
|------|----------|----------|
| é˜¶æ®µ0ï¼šç¯å¢ƒå‡†å¤‡ | 1å¤© | 1å¤© |
| é˜¶æ®µ1ï¼šåŸºç¡€è®¾æ–½ | 2-3å¤© | 4å¤© |
| é˜¶æ®µ2ï¼šè§†é¢‘æ’­æ”¾å™¨ | 2å¤© | 6å¤© |
| é˜¶æ®µ3ï¼šæ³¢å½¢æ—¶é—´è½´ | 3-4å¤© | 10å¤© |
| é˜¶æ®µ4ï¼šå­—å¹•åˆ—è¡¨ | 2-3å¤© | 13å¤© |
| é˜¶æ®µ5ï¼šé›†æˆä¼˜åŒ– | 2å¤© | 15å¤© |

**æ€»è®¡ï¼šçº¦15ä¸ªå·¥ä½œæ—¥ï¼ˆç‹¬ç«‹å¼€å‘è€…ï¼Œæ¯å¤©4-6å°æ—¶ï¼‰**

### 9.2 å…³é”®æˆåŠŸå› ç´ 

1. âœ… **Proxy è§†é¢‘è‡ªåŠ¨ç”Ÿæˆ**ï¼šè§£å†³æµè§ˆå™¨è§†é¢‘æ ¼å¼å…¼å®¹æ€§é—®é¢˜ï¼ˆå…³é”®ï¼ï¼‰
2. âœ… **Range è¯·æ±‚æ”¯æŒ**ï¼šå®ç°å¤§è§†é¢‘æµç•…æ‹–æ‹½è·³è½¬
3. âœ… **æµå¼æ³¢å½¢ç”Ÿæˆ**ï¼šé¿å…å¤§æ–‡ä»¶å†…å­˜æº¢å‡º
4. âœ… **Undo/Redo å†å²è®°å½•**ï¼šæå‡ç¼–è¾‘ä½“éªŒï¼Œé˜²æ­¢è¯¯æ“ä½œ
5. âœ… **IndexedDB è‡ªåŠ¨ä¿å­˜**ï¼šæ›¿ä»£ localStorageï¼Œæ”¯æŒå¤§æ•°æ®é‡
6. âœ… **Pinia Store ç»Ÿä¸€ç®¡ç†**ï¼šç®€åŒ–æ•°æ®æµ
7. âœ… **è™šæ‹Ÿæ»šåŠ¨**ï¼šæ”¯æŒåƒæ¡å­—å¹•åˆ—è¡¨
8. âœ… **åŒå‘ç»‘å®šé˜²æŠ–**ï¼šé¿å…å¾ªç¯æ›´æ–°
9. âœ… **æ¸è¿›å¼å¼€å‘**ï¼šæ¯ä¸ªé˜¶æ®µç‹¬ç«‹å¯éªŒè¯

### 9.3 é£é™©æ§åˆ¶

| é£é™© | å½±å“ | åº”å¯¹ç­–ç•¥ |
|------|------|----------|
| **è§†é¢‘æ ¼å¼ä¸å…¼å®¹** | â­â­â­ é«˜ | Proxy è§†é¢‘è‡ªåŠ¨è½¬ç ï¼ˆå·²å®ç°ï¼‰ |
| **å¤§è§†é¢‘æ— æ³•æ‹–æ‹½** | â­â­ ä¸­ | Range è¯·æ±‚æ”¯æŒï¼ˆå·²å®ç°ï¼‰ |
| **æ³¢å½¢ç”Ÿæˆå†…å­˜æº¢å‡º** | â­â­ ä¸­ | æµå¼ WAV è¯»å–ï¼ˆå·²å®ç°ï¼‰ |
| wavesurfer ç‰ˆæœ¬å…¼å®¹é—®é¢˜ | é«˜ | é”å®šç‰ˆæœ¬å·ï¼Œå‚è€ƒå®˜æ–¹ç¤ºä¾‹ |
| æµè§ˆå™¨å†…å­˜æº¢å‡º | ä¸­ | é™åˆ¶æœ€å¤§å­—å¹•æ•°é‡ï¼Œæç¤ºå‡çº§è®¾å¤‡ |
| æ—¶é—´ç²¾åº¦ä¸¢å¤± | ä½ | ç»Ÿä¸€ä½¿ç”¨3ä½å°æ•°ï¼Œå®¹å·®æ¯”è¾ƒ |

**âš ï¸ é£é™©ä¼˜å…ˆçº§è¯´æ˜ï¼š**
- â­â­â­ å…³é”®é£é™©ï¼šä¸è§£å†³ä¼šå¯¼è‡´æ ¸å¿ƒåŠŸèƒ½æ— æ³•ä½¿ç”¨
- â­â­ é‡è¦é£é™©ï¼šå½±å“ç”¨æˆ·ä½“éªŒ
- æ™®é€šé£é™©ï¼šå¯é€šè¿‡workaroundè§„é¿

---

**æœ¬æ–‡æ¡£æ˜¯ä¸€ä»½å®æˆ˜å¼€å‘æŒ‡å—ï¼Œé’ˆå¯¹ç‹¬ç«‹å¼€å‘è€…ä¼˜åŒ–ï¼Œå¼ºè°ƒæ¸è¿›å¼å¼€å‘å’Œå¿«é€ŸéªŒè¯ã€‚**
**æ¯ä¸ªé˜¶æ®µéƒ½æœ‰æ˜ç¡®çš„éªŒæ”¶æ ‡å‡†ï¼Œç¡®ä¿é¡¹ç›®å¯æ§æ¨è¿›ã€‚**

ğŸš€ **å¼€å§‹å¼€å‘å‰ï¼Œè¯·å…ˆåœ¨ç‹¬ç«‹åˆ†æ”¯ä¸Šå®Œæˆé˜¶æ®µ0-1ï¼ŒéªŒè¯åŸºç¡€è®¾æ–½æ­å»ºæ— è¯¯åå†ç»§ç»­ã€‚**
